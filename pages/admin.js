'use client'

import React, { useState, useCallback, useEffect } from 'react'
import { Button, Modal, ModalContent, ModalHeader, ModalBody, ModalFooter, useDisclosure, Card, CardBody, Input, Textarea, Select, SelectItem, Chip, Divider, Spinner } from '@heroui/react'

// Ïª¥Ìè¨ÎÑåÌä∏ imports
import { HotelInfoSection } from '@/components/sections/HotelInfoSection'
import RoomInfoEditor from '@/components/room/RoomInfoEditor'
import FacilitiesInfo from '@/components/facilities/FacilitiesInfo'
import CheckInOutInfo from '@/components/checkin/CheckInOutInfo'
import Package from '@/components/package/Package'
import PriceTable from '@/components/price/PriceTable'
import CancelPolicy from '@/components/cancel/CancelPolicy'
import BookingConfirmation from '@/components/policy/BookingConfirmation'
import Notice from '@/components/notice/Notice'

// ÏïÑÏù¥ÏΩò ÎåÄÏã† Ïù¥Î™®ÏßÄ ÏÇ¨Ïö©
const Icons = {
  settings: '‚öôÔ∏è',
  eye: 'üëÅÔ∏è',
  copy: 'üìã',
  refresh: 'üîÑ',
  database: 'üóÑÔ∏è',
  home: 'üè†',
  users: 'üë•',
  dollar: 'üí∞',
  file: 'üìÑ',
  calendar: 'üìÖ',
  shield: 'üõ°Ô∏è',
  plus: '‚ûï',
  edit: '‚úèÔ∏è',
  delete: 'üóëÔ∏è',
  save: 'üíæ',
  download: 'üì•',
  upload: 'üì§',
  check: '‚úÖ',
  warning: '‚ö†Ô∏è',
  info: '‚ÑπÔ∏è'
}

// Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞
const INITIAL_DATA = {
  hotel: {
    name: 'ÏÉòÌîå Ìò∏ÌÖî',
    address: 'ÏÑúÏö∏Ïãú Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 123',
    description: 'Ìé∏ÏïàÌïòÍ≥† ÏïÑÎäëÌïú ÎèÑÏã¨ ÏÜç Ìú¥ÏãùÍ≥µÍ∞ÑÏûÖÎãàÎã§.',
    phone: '02-1234-5678',
    imageUrl: '',
    email: '',
    website: ''
  },
  rooms: [
    {
      name: 'Ïä§ÌÉ†Îã§Îìú',
      type: 'Ïä§ÌÉ†Îã§Îìú',
      structure: 'ÏõêÎ£∏',
      bedType: 'ÌÄ∏ Î≤†Îìú 1Í∞ú',
      view: 'ÏãúÌã∞Î∑∞',
      standardCapacity: 2,
      maxCapacity: 2,
      description: 'Ìé∏ÏïàÌïú ÏàôÎ©¥ÏùÑ ÏúÑÌïú ÌÄ∏ Î≤†ÎìúÍ∞Ä Íµ¨ÎπÑÎêú Ïä§ÌÉ†Îã§Îìú Î£∏ÏûÖÎãàÎã§.',
      image: '',
      amenities: ['Î¨¥Î£å Wi-Fi', 'ÏóêÏñ¥Ïª®', 'TV', 'ÎØ∏ÎãàÎ∞î']
    }
  ],
  facilities: {
    general: ['Î¨¥Î£å Wi-Fi', '24ÏãúÍ∞Ñ ÌîÑÎü∞Ìä∏ Îç∞Ïä§ÌÅ¨', 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞'],
    business: ['ÎπÑÏ¶àÎãàÏä§ ÏÑºÌÑ∞', 'ÌöåÏùòÏã§'],
    leisure: ['ÌîºÌä∏ÎãàÏä§ ÏÑºÌÑ∞', 'ÏÇ¨Ïö∞ÎÇò'],
    dining: ['Î†àÏä§ÌÜ†Îûë', 'Ïπ¥Ìéò', 'Î£∏ÏÑúÎπÑÏä§']
  },
  checkin: {
    checkInTime: '15:00',
    checkOutTime: '11:00',
    earlyCheckIn: 'Ï∂îÍ∞Ä ÏöîÍ∏à Î∞úÏÉù',
    lateCheckOut: 'Ï∂îÍ∞Ä ÏöîÍ∏à Î∞úÏÉù'
  },
  packages: [{
    name: 'Î°úÎß®Ìã± Ìå®ÌÇ§ÏßÄ',
    description: 'Ïª§ÌîåÏùÑ ÏúÑÌïú ÌäπÎ≥ÑÌïú Ìå®ÌÇ§ÏßÄ',
    price: 150000,
    includes: ['ÏÉ¥ÌéòÏù∏', 'ÍΩÉÎã§Î∞ú', 'Îä¶ÏùÄ Ï≤¥ÌÅ¨ÏïÑÏõÉ']
  }],
  pricing: {
    lodges: [{
      name: 'ÏÉòÌîå Ìò∏ÌÖî',
      rooms: [{
        roomType: 'Ïä§ÌÉ†Îã§Îìú',
        view: 'ÏãúÌã∞Î∑∞',
        prices: {
          weekday: 100000,
          friday: 120000,
          saturday: 150000
        }
      }]
    }],
    dayTypes: [
      { id: 'weekday', name: 'Ï£ºÏ§ë(Ïõî~Î™©)', type: 'weekday' },
      { id: 'friday', name: 'Í∏àÏöîÏùº', type: 'friday' },
      { id: 'saturday', name: 'ÌÜ†ÏöîÏùº', type: 'saturday' }
    ]
  },
  cancel: {
    freeCancellation: 'Ï≤¥ÌÅ¨Ïù∏ 7Ïùº Ï†ÑÍπåÏßÄ Î¨¥Î£å Ï∑®ÏÜå',
    cancellationFee: 'Ï≤¥ÌÅ¨Ïù∏ 3Ïùº Ï†Ñ~ÎãπÏùº: Ï≤´ÎÇ† ÏöîÍ∏àÏùò 100%',
    noShow: 'ÎÖ∏Ïáº Ïãú Ï†ÑÏï° Ï≤≠Íµ¨',
    modificationPolicy: 'ÎÇ†Ïßú Î≥ÄÍ≤ΩÏùÄ Ï≤¥ÌÅ¨Ïù∏ 3Ïùº Ï†ÑÍπåÏßÄ Í∞ÄÎä•'
  },
  booking: {
    reservationMethod: 'Ïò®ÎùºÏù∏ ÏòàÏïΩ ÏãúÏä§ÌÖú',
    paymentMethods: ['Ïã†Ïö©Ïπ¥Îìú', 'Í≥ÑÏ¢åÏù¥Ï≤¥', 'ÌòÑÍ∏à'],
    confirmationTime: 'ÏòàÏïΩ ÌõÑ 24ÏãúÍ∞Ñ Ïù¥ÎÇ¥ ÌôïÏù∏',
    specialRequests: 'Ï≤¥ÌÅ¨Ïù∏ Ïãú ÏöîÏ≤≠ÏÇ¨Ìï≠ Ï†ÑÎã¨ Í∞ÄÎä•'
  },
  notices: [{
    title: 'Ï§ëÏöî ÏïàÎÇ¥',
    content: 'Ï≤¥ÌÅ¨Ïù∏ Ïãú Ïã†Î∂ÑÏ¶ùÏùÑ ÏßÄÏ∞∏Ìï¥ Ï£ºÏÑ∏Ïöî.',
    type: 'important'
  }]
}

// ÌÉ≠ ÏÑ§Ï†ï
const TAB_CONFIG = [
  { key: 'hotel', label: 'Ìò∏ÌÖî Ï†ïÎ≥¥', icon: Icons.home, component: HotelInfoSection },
  { key: 'rooms', label: 'Í∞ùÏã§ Ï†ïÎ≥¥', icon: Icons.users, component: RoomInfoEditor },
  { key: 'facilities', label: 'ÏãúÏÑ§ Ï†ïÎ≥¥', icon: Icons.settings, component: FacilitiesInfo },
  { key: 'checkin', label: 'Ï≤¥ÌÅ¨Ïù∏/ÏïÑÏõÉ', icon: Icons.calendar, component: CheckInOutInfo },
  { key: 'packages', label: 'Ìå®ÌÇ§ÏßÄ', icon: Icons.file, component: Package },
  { key: 'pricing', label: 'ÏöîÍ∏àÌëú', icon: Icons.dollar, component: PriceTable },
  { key: 'cancel', label: 'Ï∑®ÏÜåÍ∑úÏ†ï', icon: Icons.shield, component: CancelPolicy },
  { key: 'booking', label: 'ÏòàÏïΩÏïàÎÇ¥', icon: Icons.database, component: BookingConfirmation },
  { key: 'notices', label: 'Í≥µÏßÄÏÇ¨Ìï≠', icon: Icons.file, component: Notice }
]

export default function AdminPage() {
  const [data, setData] = useState(INITIAL_DATA)
  const [activeTab, setActiveTab] = useState('hotel')
  const [generatedHtml, setGeneratedHtml] = useState('')
  const [isGenerating, setIsGenerating] = useState(false)
  const [lastGenerated, setLastGenerated] = useState(null)
  const [isLoading, setIsLoading] = useState(false)
  const [notification, setNotification] = useState({ show: false, message: '', type: 'success' })
  const [searchTerm, setSearchTerm] = useState('')
  const [viewMode, setViewMode] = useState('grid') // grid, list
  
  const { isOpen: isModalOpen, onOpen: onModalOpen, onClose: onModalClose } = useDisclosure()
  const { isOpen: isPreviewOpen, onOpen: onPreviewOpen, onClose: onPreviewClose } = useDisclosure()
  const { isOpen: isSettingsOpen, onOpen: onSettingsOpen, onClose: onSettingsClose } = useDisclosure()
  // Ìò∏ÌÖî Ï†ïÎ≥¥ Î™®Îã¨ ÏÉÅÌÉú Ï∂îÍ∞Ä
  const { isOpen: isHotelModalOpen, onOpen: onHotelModalOpen, onClose: onHotelModalClose } = useDisclosure();

  // ÏïåÎ¶º ÌëúÏãú Ìï®Ïàò
  const showNotification = useCallback((message, type = 'success') => {
    setNotification({ show: true, message, type })
    setTimeout(() => setNotification({ show: false, message: '', type: 'success' }), 3000)
  }, [])

  // Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ Ìï∏Îì§Îü¨
  const updateData = useCallback((section, newData) => {
    setData(prev => ({
      ...prev,
      [section]: newData
    }))
    console.log(`${section} Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏:`, newData)
    showNotification(`${section} Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.`)
  }, [showNotification])

  // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ìï®Ïàò
  const saveData = useCallback(async () => {
    setIsLoading(true)
    try {
      const response = await fetch('/api/saveSession', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      if (response.ok) {
        showNotification('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.', 'success')
      } else {
        throw new Error('Ï†ÄÏû• Ïã§Ìå®')
      }
    } catch (error) {
      showNotification('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error')
    } finally {
      setIsLoading(false)
    }
  }, [data, showNotification])

  // Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®Ïàò
  const loadData = useCallback(async () => {
    setIsLoading(true)
    try {
      const response = await fetch('/api/saveSession')
      if (response.ok) {
        const result = await response.json()
        if (result.status === 'success' && result.data) {
          // id ÌïÑÎìúÎ•º Ï†úÏô∏Ìïú Îç∞Ïù¥ÌÑ∞Îßå ÏÑ§Ï†ï
          const { id, ...dataToSet } = result.data
          setData(dataToSet)
          showNotification('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success')
        } else {
          showNotification('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning')
        }
      } else {
        throw new Error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®')
      }
    } catch (error) {
      showNotification('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.', 'error')
    } finally {
      setIsLoading(false)
    }
  }, [showNotification])

  // HTML ÏÉùÏÑ± Ìï®Ïàò
  const generateHTML = useCallback(async () => {
    setIsGenerating(true)
    console.log('HTML ÏÉùÏÑ± ÏãúÏûë...')
    
    try {
      const fullHtml = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.hotel.name} - Ìò∏ÌÖî ÏÉÅÏÑ∏Ï†ïÎ≥¥</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif; 
            line-height: 1.6; color: #333; background: #f8f9fa; padding: 20px; 
        }
        .container { 
            max-width: 1200px; margin: 0 auto; background: white; 
            border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; 
        }
        .section { padding: 32px; border-bottom: 1px solid #eee; }
        .section:last-child { border-bottom: none; }
        h1 { font-size: 2.5em; color: #2c3e50; margin-bottom: 1em; }
        h2 { font-size: 2em; color: #34495e; margin-bottom: 0.8em; border-bottom: 3px solid #3498db; padding-bottom: 0.5em; }
        h3 { font-size: 1.5em; color: #2c3e50; margin-bottom: 0.6em; }
        p { margin-bottom: 1em; line-height: 1.8; }
        .grid { display: grid; gap: 20px; margin: 20px 0; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; background: #fafafa; }
        .table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .table th, .table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .table th { background: #f2f2f2; font-weight: 600; }
        .highlight { background: #e8f4fd; padding: 20px; border-radius: 8px; border-left: 4px solid #3498db; }
        .badge { display: inline-block; background: #3498db; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9em; margin: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <h1>${data.hotel.name}</h1>
            <p><strong>Ï£ºÏÜå:</strong> ${data.hotel.address}</p>
            <p>${data.hotel.description}</p>
            <p><strong>Ï†ÑÌôîÎ≤àÌò∏:</strong> ${data.hotel.phoneNumber}</p>
            <p><strong>Ï≤¥ÌÅ¨Ïù∏:</strong> ${data.hotel.checkInTime} | <strong>Ï≤¥ÌÅ¨ÏïÑÏõÉ:</strong> ${data.hotel.checkOutTime}</p>
        </div>
        
        <div class="section">
            <h2>Í∞ùÏã§ Ï†ïÎ≥¥</h2>
            <div class="grid grid-2">
                ${data.rooms.map(room => `
                    <div class="card">
                        <h3>${room.roomType} (${room.view})</h3>
                        <p><strong>ÌÅ¨Í∏∞:</strong> ${room.roomSize}</p>
                        <p><strong>Ïπ®ÎåÄ:</strong> ${room.bedInfo}</p>
                        <p><strong>ÏµúÎåÄ Ïù∏Ïõê:</strong> ${room.maxOccupancy}Î™Ö</p>
                        <p>${room.description}</p>
                        <div>
                            <strong>Ìé∏ÏùòÏãúÏÑ§:</strong>
                            ${room.amenities.map(amenity => `<span class="badge">${amenity}</span>`).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <div class="section">
            <h2>Ìå®ÌÇ§ÏßÄ Ï†ïÎ≥¥</h2>
            <div class="grid grid-2">
                ${data.packages.map(pkg => `
                    <div class="card">
                        <h3>${pkg.name}</h3>
                        <p>${pkg.description}</p>
                        <p><strong>Í∞ÄÍ≤©:</strong> ${pkg.price.toLocaleString()}Ïõê</p>
                        <div>
                            <strong>Ìè¨Ìï®ÏÇ¨Ìï≠:</strong>
                            ${pkg.includes.map(item => `<span class="badge">${item}</span>`).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <div class="section">
            <h2>Ï∑®ÏÜå/ÌôòÎ∂à Í∑úÏ†ï</h2>
            <div class="highlight">
                <p><strong>Î¨¥Î£å Ï∑®ÏÜå:</strong> ${data.cancel.freeCancellation}</p>
                <p><strong>Ï∑®ÏÜå ÏàòÏàòÎ£å:</strong> ${data.cancel.cancellationFee}</p>
                <p><strong>ÎÖ∏Ïáº:</strong> ${data.cancel.noShow}</p>
                <p><strong>Î≥ÄÍ≤Ω Ï†ïÏ±Ö:</strong> ${data.cancel.modificationPolicy}</p>
            </div>
        </div>
    </div>
</body>
</html>`

      setGeneratedHtml(fullHtml)
      setLastGenerated(new Date())
      console.log('HTML ÏÉùÏÑ± ÏôÑÎ£å, Í∏∏Ïù¥:', fullHtml.length)
    } catch (error) {
      console.error('HTML ÏÉùÏÑ± Ïò§Î•ò:', error)
    } finally {
      setIsGenerating(false)
    }
  }, [data])

  // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
  const copyToClipboard = useCallback(async () => {
    try {
      await navigator.clipboard.writeText(generatedHtml)
      showNotification('HTMLÏù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success')
    } catch (error) {
      console.error('Î≥µÏÇ¨ Ïã§Ìå®:', error)
      // Ìè¥Î∞±: ÌÖçÏä§Ìä∏ ÏòÅÏó≠ ÏÇ¨Ïö©
      const textArea = document.createElement('textarea')
      textArea.value = generatedHtml
      document.body.appendChild(textArea)
      textArea.select()
      document.execCommand('copy')
      document.body.removeChild(textArea)
      showNotification('HTMLÏù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success')
    }
  }, [generatedHtml, showNotification])

  // HTML Îã§Ïö¥Î°úÎìú
  const downloadHtml = useCallback(() => {
    const blob = new Blob([generatedHtml], { type: 'text/html' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `hotel-${Date.now()}.html`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
    showNotification('HTML ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success')
  }, [generatedHtml, showNotification])

  // ÌòÑÏû¨ ÌÉ≠ ÏÑ§Ï†ï
  const currentTabConfig = TAB_CONFIG.find(tab => tab.key === activeTab)
  const CurrentComponent = currentTabConfig?.component

  // ÌïÑÌÑ∞ÎßÅÎêú ÌÉ≠ ÏÑ§Ï†ï
  const filteredTabs = TAB_CONFIG.filter(tab => 
    tab.label.toLowerCase().includes(searchTerm.toLowerCase()) ||
    tab.key.toLowerCase().includes(searchTerm.toLowerCase())
  )

  // ÌÉ≠ ÌÅ¥Î¶≠ Ìï∏Îì§Îü¨ ÏàòÏ†ï
  const handleTabClick = (tab) => {
    setActiveTab(tab.key);
    if (tab.key === 'hotel') {
      onHotelModalOpen();
    } else if (tab.key === 'rooms' || tab.key === 'notices') {
      onModalOpen();
    }
  };

  // value Ï†ÑÎã¨ Î°úÏßÅ Í∞ÄÎèÖÏÑ± Î∞è Ïò§Î•ò Î∞©ÏßÄ Í∞úÏÑ†
  let sectionValue = data[activeTab];
  if (activeTab === 'rooms' && (!data.rooms || !Array.isArray(data.rooms) || data.rooms.length === 0)) {
    sectionValue = [{
      name: '', type: '', structure: '', bedType: '', view: '', standardCapacity: 2, maxCapacity: 2, description: '', image: '', amenities: []
    }];
  } else if (activeTab === 'hotel' && (!data.hotel || typeof data.hotel !== 'object')) {
    sectionValue = { name: '', address: '', description: '', imageUrl: '', phone: '', email: '', website: '' };
  } else if (activeTab === 'notices' && (!data.notices || !Array.isArray(data.notices) || data.notices.length === 0)) {
    sectionValue = [{ content: '' }];
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
      {/* ÏïåÎ¶º */}
      {notification.show && (
        <div className={`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
          notification.type === 'success' ? 'bg-green-500 text-white' :
          notification.type === 'error' ? 'bg-red-500 text-white' :
          'bg-blue-500 text-white'
        }`}>
          {notification.message}
        </div>
      )}

      {/* Ìó§Îçî */}
      <div className="bg-white shadow-lg border-b">
        <div className="max-w-7xl mx-auto px-6 py-6">
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 flex items-center gap-3">
                üè® Ìò∏ÌÖî ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ Í¥ÄÎ¶¨Ïûê
                {isLoading && <Spinner size="sm" />}
              </h1>
              <p className="text-gray-600 mt-2 text-lg">Ìò∏ÌÖî Ï†ïÎ≥¥Î•º Í¥ÄÎ¶¨ÌïòÍ≥† HTMLÏùÑ ÏÉùÏÑ±ÌïòÏÑ∏Ïöî</p>
            </div>
            <div className="flex gap-3">
              <Button
                color="primary"
                variant="flat"
                onPress={onSettingsOpen}
                startContent={Icons.settings}
              >
                ÏÑ§Ï†ï
              </Button>
              <Button
                color="primary"
                variant="flat"
                onPress={onPreviewOpen}
                startContent={Icons.eye}
              >
                ÎØ∏Î¶¨Î≥¥Í∏∞
              </Button>
              <Button
                color="success"
                onPress={generateHTML}
                isLoading={isGenerating}
                startContent={Icons.refresh}
              >
                HTML ÏÉùÏÑ±
              </Button>
              {generatedHtml && (
                <>
                  <Button
                    color="secondary"
                    onPress={copyToClipboard}
                    startContent={Icons.copy}
                  >
                    Î≥µÏÇ¨
                  </Button>
                  <Button
                    color="primary"
                    onPress={downloadHtml}
                    startContent={Icons.download}
                  >
                    Îã§Ïö¥Î°úÎìú
                  </Button>
                </>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* 1. ÏÉÅÎã® Í∞ÄÎ°ú ÌÉ≠ Î©îÎâ¥ Ï∂îÍ∞Ä */}
      <div className="flex gap-2 border-b bg-white px-6 pt-4">
        {TAB_CONFIG.map(tab => (
          <button
            key={tab.key}
            className={`tab ${activeTab === tab.key ? 'active' : ''}`}
            onClick={() => handleTabClick(tab)}
            type="button"
          >
            <span className="text-xl mr-1">{tab.icon}</span>
            {tab.label}
          </button>
        ))}
      </div>

      {/* Î©îÏù∏ Ïª®ÌÖêÏ∏†: ÏÑ†ÌÉùÎêú ÌÉ≠Îßå Í∞ÄÎ°ú Ïπ¥ÎìúÎ°ú Î≥¥Ïó¨Ï§å */}
      <div className="flex flex-row gap-6 mt-8 px-6">
        {TAB_CONFIG.filter(tab => tab.key === activeTab).map(tab => (
          <Card
            key={tab.key}
            isPressable
            className="w-full max-w-xl hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105"
            onPress={() => handleTabClick(tab)}
          >
            <CardBody className="p-6">
              <div className="flex items-center gap-4">
                <div className="p-4 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl">
                  <span className="text-3xl">{tab.icon}</span>
                </div>
                <div className="flex-1">
                  <h3 className="text-lg font-bold text-gray-900 mb-1">{tab.label}</h3>
                  <p className="text-gray-600 text-sm">
                    {tab.key === 'hotel' && 'Í∏∞Î≥∏ Ï†ïÎ≥¥ Í¥ÄÎ¶¨'}
                    {tab.key === 'rooms' && `${data.rooms.length}Í∞ú Í∞ùÏã§`}
                    {tab.key === 'facilities' && 'ÏãúÏÑ§ Î∞è Ìé∏ÏùòÏãúÏÑ§'}
                    {tab.key === 'checkin' && 'Ï≤¥ÌÅ¨Ïù∏/ÏïÑÏõÉ Ï†ïÏ±Ö'}
                    {tab.key === 'packages' && `${data.packages.length}Í∞ú Ìå®ÌÇ§ÏßÄ`}
                    {tab.key === 'pricing' && 'ÏöîÍ∏à Î∞è Í∞ÄÍ≤©Ìëú'}
                    {tab.key === 'cancel' && 'Ï∑®ÏÜå Î∞è ÌôòÎ∂à Í∑úÏ†ï'}
                    {tab.key === 'booking' && 'ÏòàÏïΩ Í¥ÄÎ†® ÏïàÎÇ¥'}
                    {tab.key === 'notices' && `${data.notices.length}Í∞ú Í≥µÏßÄ`}
                  </p>
                  <div className="mt-2">
                    <Chip size="sm" color="primary" variant="flat">
                      Ìé∏Ïßë Í∞ÄÎä•
                    </Chip>
                  </div>
                </div>
              </div>
            </CardBody>
          </Card>
        ))}
      </div>

      {/* 2. Î™®Îã¨(ÌåùÏóÖ) ÎèôÏûë Ïò§Î•ò ÏàòÏ†ï: CurrentComponent, useDisclosure, Ï°∞Í±¥ Î™ÖÌôïÌôî */}
      {/* Ìò∏ÌÖî Ï†ïÎ≥¥ Î™®Îã¨(Î≥ÑÎèÑ) */}
      <Modal
        key="hotel"
        isOpen={isHotelModalOpen}
        onClose={onHotelModalClose}
        size="5xl"
        scrollBehavior="inside"
        classNames={{ base: "max-h-[90vh]", body: "p-0" }}
      >
        <ModalContent>
          <ModalHeader className="flex items-center justify-between px-6 py-4 border-b">
            <div className="flex items-center gap-3">
              <span className="text-2xl">{Icons.home}</span>
              <span className="text-xl font-bold">Ìò∏ÌÖî Ï†ïÎ≥¥</span>
            </div>
            <div className="flex gap-2">
              <Button
                size="sm"
                color="primary"
                variant="bordered"
                onPress={saveData}
                isLoading={isLoading}
                startContent={Icons.save}
              >
                Ï†ÄÏû•
              </Button>
            </div>
          </ModalHeader>
          <ModalBody className="p-6">
            <HotelInfoSection
              value={data.hotel}
              onChange={newData => updateData('hotel', newData)}
            />
          </ModalBody>
          <ModalFooter>
            <Button color="danger" variant="light" onPress={onHotelModalClose}>
              Ï∑®ÏÜå
            </Button>
            <Button color="primary" onPress={onHotelModalClose}>
              ÏôÑÎ£å
            </Button>
          </ModalFooter>
        </ModalContent>
      </Modal>
      {/* Í∏∞Ï°¥ Í≥µÌÜµ Î™®Îã¨(rooms, noticesÎßå) */}
      {activeTab !== 'hotel' && (
        <Modal
          key={activeTab}
          isOpen={isModalOpen}
          onClose={onModalClose}
          size="5xl"
          scrollBehavior="inside"
          classNames={{ base: "max-h-[90vh]", body: "p-0" }}
        >
          <ModalContent>
            <ModalHeader className="flex items-center justify-between px-6 py-4 border-b">
              <div className="flex items-center gap-3">
                {TAB_CONFIG.find(tab => tab.key === activeTab) && (
                  <>
                    <span className="text-2xl">{TAB_CONFIG.find(tab => tab.key === activeTab).icon}</span>
                    <span className="text-xl font-bold">{TAB_CONFIG.find(tab => tab.key === activeTab).label}</span>
                  </>
                )}
              </div>
              <div className="flex gap-2">
                <Button
                  size="sm"
                  color="primary"
                  variant="bordered"
                  onPress={saveData}
                  isLoading={isLoading}
                  startContent={Icons.save}
                >
                  Ï†ÄÏû•
                </Button>
              </div>
            </ModalHeader>
            <ModalBody className="p-6">
              {TAB_CONFIG.find(tab => tab.key === activeTab)?.component && (
                React.createElement(
                  TAB_CONFIG.find(tab => tab.key === activeTab).component,
                  {
                    value: sectionValue,
                    onChange: (newData) => updateData(activeTab, newData)
                  }
                )
              )}
            </ModalBody>
            <ModalFooter>
              <Button color="danger" variant="light" onPress={onModalClose}>
                Ï∑®ÏÜå
              </Button>
              <Button color="primary" onPress={onModalClose}>
                ÏôÑÎ£å
              </Button>
            </ModalFooter>
          </ModalContent>
        </Modal>
      )}

      {/* ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ */}
      <Modal 
        isOpen={isPreviewOpen} 
        onClose={onPreviewClose}
        size="full"
        scrollBehavior="inside"
      >
        <ModalContent>
          <ModalHeader className="flex items-center justify-between px-6 py-4 border-b">
            <div className="flex items-center gap-3">
              <span className="text-2xl">{Icons.eye}</span>
              <span className="text-xl font-bold">ÎØ∏Î¶¨Î≥¥Í∏∞</span>
            </div>
            <div className="flex gap-2">
              <Button
                size="sm"
                color="primary"
                onPress={generateHTML}
                isLoading={isGenerating}
                startContent={Icons.refresh}
              >
                ÏÉàÎ°úÍ≥†Ïπ®
              </Button>
              {generatedHtml && (
                <>
                  <Button
                    size="sm"
                    color="success"
                    onPress={copyToClipboard}
                    startContent={Icons.copy}
                  >
                    Î≥µÏÇ¨
                  </Button>
                  <Button
                    size="sm"
                    color="primary"
                    onPress={downloadHtml}
                    startContent={Icons.download}
                  >
                    Îã§Ïö¥Î°úÎìú
                  </Button>
                </>
              )}
            </div>
          </ModalHeader>
          <ModalBody className="p-0">
            {generatedHtml ? (
              <iframe
                srcDoc={generatedHtml}
                className="w-full h-full min-h-[80vh]"
                title="ÎØ∏Î¶¨Î≥¥Í∏∞"
              />
            ) : (
              <div className="flex items-center justify-center h-96">
                <div className="text-center">
                  <span className="text-6xl mb-4">{Icons.eye}</span>
                  <p className="text-gray-500 text-lg mb-6">HTMLÏùÑ Î®ºÏ†Ä ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî</p>
                  <Button
                    color="primary"
                    size="lg"
                    onPress={generateHTML}
                    isLoading={isGenerating}
                    startContent={Icons.refresh}
                  >
                    HTML ÏÉùÏÑ±
                  </Button>
                </div>
              </div>
            )}
          </ModalBody>
        </ModalContent>
      </Modal>

      {/* ÏÑ§Ï†ï Î™®Îã¨ */}
      <Modal 
        isOpen={isSettingsOpen} 
        onClose={onSettingsClose}
        size="2xl"
      >
        <ModalContent>
          <ModalHeader className="flex items-center gap-3">
            <span className="text-2xl">{Icons.settings}</span>
            <span className="text-xl font-bold">ÏÑ§Ï†ï</span>
          </ModalHeader>
          <ModalBody className="p-6">
            <div className="space-y-6">
              <div>
                <h3 className="text-lg font-semibold mb-3">Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h3>
                <div className="flex gap-3">
                  <Button
                    color="primary"
                    variant="bordered"
                    onPress={loadData}
                    isLoading={isLoading}
                    startContent={Icons.upload}
                  >
                    Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                  </Button>
                  <Button
                    color="success"
                    onPress={saveData}
                    isLoading={isLoading}
                    startContent={Icons.save}
                  >
                    Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                  </Button>
                </div>
              </div>
              
              <Divider />
              
              <div>
                <h3 className="text-lg font-semibold mb-3">HTML ÏÉùÏÑ± ÏÑ§Ï†ï</h3>
                <div className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span>ÏûêÎèô Ï†ÄÏû•</span>
                    <input type="checkbox" defaultChecked className="w-4 h-4" />
                  </div>
                  <div className="flex items-center justify-between">
                    <span>ÎØ∏Î¶¨Î≥¥Í∏∞ ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®</span>
                    <input type="checkbox" defaultChecked className="w-4 h-4" />
                  </div>
                </div>
              </div>
            </div>
          </ModalBody>
          <ModalFooter>
            <Button color="danger" variant="light" onPress={onSettingsClose}>
              Ï∑®ÏÜå
            </Button>
            <Button color="primary" onPress={onSettingsClose}>
              Ï†ÄÏû•
            </Button>
          </ModalFooter>
        </ModalContent>
      </Modal>
    </div>
  )
} 