import React, { useState, useEffect } from 'react';

export default function DatabaseManager({ currentData, updateData }) {
  const [hotels, setHotels] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [message, setMessage] = useState('');
  const [dbStatus, setDbStatus] = useState(null);
  
  // ì¸ë¼ì¸ í˜¸í…” ìƒì„± í¼ ìƒíƒœ
  const [isCreatingNew, setIsCreatingNew] = useState(false);
  const [newHotelForm, setNewHotelForm] = useState({
    name: '',
    description: '',
    address: '',
    phone: '',
    checkin_time: '15:00',
    checkout_time: '11:00'
  });
  
  // í˜„ì¬ ì‘ì—… ì¤‘ì¸ í”„ë¡œì íŠ¸ (í˜¸í…”ëª… + íŒ¨í‚¤ì§€ëª… ì¡°í•©)
  const [currentProject, setCurrentProject] = useState(() => {
    if (typeof window !== 'undefined') {
      try {
        const saved = localStorage.getItem('currentProject');
        return saved ? JSON.parse(saved) : null;
      } catch (error) {
        console.error('localStorage ë³µì› ì‹¤íŒ¨:', error);
        return null;
      }
    }
    return null;
  });

  // ìµœê·¼ ì‘ì—… ì´ë ¥
  const [recentProjects, setRecentProjects] = useState(() => {
    if (typeof window !== 'undefined') {
      try {
        const saved = localStorage.getItem('recentProjects');
        return saved ? JSON.parse(saved) : [];
      } catch (error) {
        return [];
      }
    }
    return [];
  });

  // í”„ë¡œì íŠ¸ í…œí”Œë¦¿ ëª©ë¡ (í˜¸í…” ë°ì´í„°ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ë³€í™˜)
  const [templates, setTemplates] = useState([]);

  // í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ localStorageì— ì €ì¥
  useEffect(() => {
    if (typeof window !== 'undefined' && currentProject) {
      try {
        localStorage.setItem('currentProject', JSON.stringify(currentProject));
        
        // ìµœê·¼ í”„ë¡œì íŠ¸ ëª©ë¡ì— ì¶”ê°€ (ì¤‘ë³µ ì œê±°)
        const updated = [currentProject, ...recentProjects.filter(p => 
          p.fullName !== currentProject.fullName
        )].slice(0, 10); // ìµœëŒ€ 10ê°œë§Œ ìœ ì§€
        
        setRecentProjects(updated);
        localStorage.setItem('recentProjects', JSON.stringify(updated));
      } catch (error) {
        console.error('localStorage ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
  }, [currentProject]);

  // í˜„ì¬ ë°ì´í„° ë³€ê²½ ê°ì§€ ë° í”„ë¡œì íŠ¸ ì •ë³´ ë™ê¸°í™”
  useEffect(() => {
    if (currentData?.hotel?.name) {
      const packageName = extractPackageName(currentData);
      const hotelName = currentData.hotel.name;
      const fullName = `${hotelName} ${packageName}`;
      
      // í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
      setCurrentProject(prev => {
        // ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì¸ ê²½ìš°
        if (!prev || prev.fullName !== fullName) {
          return {
            hotelName,
            packageName,
            fullName,
            lastModified: new Date().toISOString(),
            isModified: true,
            version: prev?.version || '1.0',
            id: prev?.id || null,
            isNew: !prev?.id
          };
        }
        
        // ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ìˆ˜ì •ì´ ë°œìƒí•œ ê²½ìš°
        if (!prev.isModified) {
          return {
            ...prev,
            hotelName,
            packageName,
            fullName,
            isModified: true,
            lastModified: new Date().toISOString()
          };
        }
        
        return {
          ...prev,
          hotelName,
          packageName,
          fullName
        };
      });
    }
  }, [currentData]);

  // íŒ¨í‚¤ì§€ëª… ì¶”ì¶œ í•¨ìˆ˜
  const extractPackageName = (data) => {
    if (data?.packages && data.packages.length > 0) {
      return data.packages[0].name || 'ê¸°ë³¸ íŒ¨í‚¤ì§€';
    }
    return 'í‘œì¤€ PKG';
  };

  // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
  const showMessage = (msg, type = 'info') => {
    setMessage({ text: msg, type });
    setTimeout(() => setMessage(''), 5000);
  };

  // ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
  const checkDatabaseStatus = async () => {
    try {
      const response = await fetch('/api/init-db');
      const result = await response.json();
      
      const hotelsResponse = await fetch('/api/hotels');
      const hotelsData = await hotelsResponse.json();
      
      setDbStatus({
        ...result,
        statistics: {
          ...result.statistics,
          hotels: hotelsData.length
        }
      });
      
      if (result.success) {
        showMessage('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ: ì •ìƒ', 'success');
      }
    } catch (error) {
      console.error('DB ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
      showMessage('ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨', 'error');
    }
  };

  // í˜¸í…” ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ë° í…œí”Œë¦¿ ë³€í™˜
  const loadHotels = async () => {
    setIsLoading(true);
    try {
      const response = await fetch('/api/hotels');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const hotels = await response.json();
      setHotels(hotels);
      
      // í˜¸í…” ë°ì´í„°ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ë³€í™˜
      const templateList = hotels.map(hotel => {
        const packageName = extractPackageFromHotel(hotel);
        return {
          id: hotel.id,
          hotelName: hotel.name,
          packageName,
          fullName: `${hotel.name} ${packageName}`,
          lastModified: hotel.updatedAt || hotel.createdAt,
          description: hotel.description,
          hasRooms: hotel.rooms?.length > 0,
          hasPackages: hotel.packages?.length > 0,
          data: hotel
        };
      });
      
      setTemplates(templateList);
      showMessage(`${hotels.length}ê°œ í…œí”Œë¦¿ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤`, 'success');
    } catch (error) {
      console.error('í˜¸í…” ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      showMessage('í…œí”Œë¦¿ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'error');
    } finally {
      setIsLoading(false);
    }
  };

  // í˜¸í…”ì—ì„œ íŒ¨í‚¤ì§€ëª… ì¶”ì¶œ
  const extractPackageFromHotel = (hotel) => {
    if (hotel.packages && hotel.packages.length > 0) {
      return hotel.packages[0].name;
    }
    
    // í˜¸í…”ëª…ì—ì„œ íŒ¨í‚¤ì§€ëª… ì¶”ì¶œ ë¡œì§
    const name = hotel.name.toLowerCase();
    if (name.includes('ì¡°ì‹')) return 'ì¡°ì‹ PKG';
    if (name.includes('ì˜¤ì…˜')) return 'ì˜¤ì…˜ PKG';
    if (name.includes('ë¹„ë°œë””')) return 'ë¹„ë°œë”” PKG';
    if (name.includes('ë¡œë§¨í‹±')) return 'ë¡œë§¨í‹± íŒ¨í‚¤ì§€';
    if (name.includes('pkg') || name.includes('íŒ¨í‚¤ì§€')) {
      const match = hotel.name.match(/([\wê°€-í£]+\s*PKG|[\wê°€-í£]+\s*íŒ¨í‚¤ì§€)/i);
      return match ? match[0] : 'í‘œì¤€ PKG';
    }
    return 'í‘œì¤€ PKG';
  };

  // ìƒˆ í”„ë¡œì íŠ¸ ì‹œì‘
  const startNewProject = () => {
    setIsCreatingNew(true);
    setNewHotelForm({
      name: '',
      description: '',
      address: '',
      phone: '',
      checkin_time: '15:00',
      checkout_time: '11:00'
    });
  };

  // ì¸ë¼ì¸ í˜¸í…” ìƒì„± í•¸ë“¤ëŸ¬
  const handleCreateNewHotel = () => {
    if (!newHotelForm.name.trim()) {
      showMessage('í˜¸í…”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
      return;
    }

    const newProject = {
      hotelName: newHotelForm.name,
      packageName: 'í‘œì¤€ PKG',
      fullName: `${newHotelForm.name} í‘œì¤€ PKG`,
      created: new Date().toISOString(),
      lastModified: new Date().toISOString(),
      version: '1.0',
      isNew: true,
      isModified: false
    };
    
    setCurrentProject(newProject);
    
    // ìƒˆ í”„ë¡œì íŠ¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
    const newData = {
      hotel: {
        name: newHotelForm.name,
        address: newHotelForm.address || 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
        description: newHotelForm.description || 'í¸ì•ˆí•˜ê³  ì•„ëŠ‘í•œ ë„ì‹¬ ì† íœ´ì‹ê³µê°„ì…ë‹ˆë‹¤.',
        image_url: '',
        phone: newHotelForm.phone || '02-1234-5678',
        checkin_time: newHotelForm.checkin_time,
        checkout_time: newHotelForm.checkout_time
      }
    };
    
    updateData(newData);
    showMessage('ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤', 'success');
  };

  // ì¸ë¼ì¸ í˜¸í…” ìƒì„± í•¸ë“¤ëŸ¬
  const handleCreateNewHotel = () => {
    if (!newHotelForm.name.trim()) {
      showMessage('í˜¸í…”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
      return;
    }

    const newProject = {
      hotelName: newHotelForm.name,
      packageName: 'í‘œì¤€ PKG',
      fullName: `${newHotelForm.name} í‘œì¤€ PKG`,
      created: new Date().toISOString(),
      lastModified: new Date().toISOString(),
      version: '1.0',
      isNew: true,
      isModified: false
    };
    
    setCurrentProject(newProject);
    
    // ìƒˆ í”„ë¡œì íŠ¸ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
    const newData = {
      hotel: {
        name: newHotelForm.name,
        address: newHotelForm.address || 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
        description: newHotelForm.description || 'í¸ì•ˆí•˜ê³  ì•„ëŠ‘í•œ ë„ì‹¬ ì† íœ´ì‹ê³µê°„ì…ë‹ˆë‹¤.',
        image_url: '',
        phone: newHotelForm.phone || '02-1234-5678',
        checkin_time: newHotelForm.checkin_time,
        checkout_time: newHotelForm.checkout_time
      },
      rooms: [{
        roomType: 'ìŠ¤íƒ ë‹¤ë“œ',
        view: 'ì‹œí‹°ë·°',
        amenities: ['ë¬´ë£Œ Wi-Fi', 'ì—ì–´ì»¨', 'TV', 'ë¯¸ë‹ˆë°”'],
        roomSize: '25ã¡',
        bedInfo: 'í€¸ ë² ë“œ 1ê°œ',
        maxOccupancy: 2,
        description: 'í¸ì•ˆí•œ ìˆ™ë©´ì„ ìœ„í•œ í€¸ ë² ë“œê°€ êµ¬ë¹„ëœ ìŠ¤íƒ ë‹¤ë“œ ë£¸ì…ë‹ˆë‹¤.',
        imageUrl: '',
        name: 'ìŠ¤íƒ ë‹¤ë“œ ë£¸'
      }],
      packages: [{
        name: 'í‘œì¤€ PKG',
        description: 'ê¸°ë³¸ íŒ¨í‚¤ì§€',
        price: 150000,
        includes: ['ì¡°ì‹', 'ë¬´ë£Œ Wi-Fi'],
        availableFrom: '2023-01-01',
        availableTo: '2023-12-31'
      }],
      facilities: {
        general: ['ë¬´ë£Œ Wi-Fi', '24ì‹œê°„ í”„ëŸ°íŠ¸ ë°ìŠ¤í¬', 'ì—˜ë¦¬ë² ì´í„°'],
        business: ['ë¹„ì¦ˆë‹ˆìŠ¤ ì„¼í„°', 'íšŒì˜ì‹¤'],
        leisure: ['í”¼íŠ¸ë‹ˆìŠ¤ ì„¼í„°', 'ì‚¬ìš°ë‚˜'],
        dining: ['ë ˆìŠ¤í† ë‘', 'ì¹´í˜', 'ë£¸ì„œë¹„ìŠ¤']
      },
      checkin: {
        checkInTime: newHotelForm.checkin_time,
        checkOutTime: newHotelForm.checkout_time,
        earlyCheckIn: 'ì¶”ê°€ ìš”ê¸ˆ ë°œìƒ',
        lateCheckOut: 'ì¶”ê°€ ìš”ê¸ˆ ë°œìƒ'
      },
      pricing: {
        lodges: [{
          name: newHotelForm.name,
          rooms: [{
            roomType: 'ìŠ¤íƒ ë‹¤ë“œ',
            view: 'ì‹œí‹°ë·°',
            prices: {
              weekday: 100000,
              friday: 120000,
              saturday: 150000
            }
          }]
        }],
        dayTypes: [
          { id: 'weekday', name: 'ì£¼ì¤‘(ì›”~ëª©)', type: 'weekday' },
          { id: 'friday', name: 'ê¸ˆìš”ì¼', type: 'friday' },
          { id: 'saturday', name: 'í† ìš”ì¼', type: 'saturday' }
        ]
      },
      cancel: {
        freeCancellation: 'ì²´í¬ì¸ 7ì¼ ì „ê¹Œì§€ ë¬´ë£Œ ì·¨ì†Œ',
        cancellationFee: 'ì²´í¬ì¸ 3ì¼ ì „~ë‹¹ì¼: ì²«ë‚  ìš”ê¸ˆì˜ 100%',
        noShow: 'ë…¸ì‡¼ ì‹œ ì „ì•¡ ì²­êµ¬',
        modificationPolicy: 'ë‚ ì§œ ë³€ê²½ì€ ì²´í¬ì¸ 3ì¼ ì „ê¹Œì§€ ê°€ëŠ¥'
      },
      booking: {
        reservationMethod: 'ì˜¨ë¼ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œ',
        paymentMethods: ['ì‹ ìš©ì¹´ë“œ', 'ê³„ì¢Œì´ì²´', 'í˜„ê¸ˆ'],
        confirmationTime: 'ì˜ˆì•½ í›„ 24ì‹œê°„ ì´ë‚´ í™•ì¸',
        specialRequests: 'ì²´í¬ì¸ ì‹œ ìš”ì²­ì‚¬í•­ ì „ë‹¬ ê°€ëŠ¥'
      },
      notices: [{
        title: 'ì¤‘ìš” ì•ˆë‚´',
        content: 'ì²´í¬ì¸ ì‹œ ì‹ ë¶„ì¦ì„ ì§€ì°¸í•´ ì£¼ì„¸ìš”.',
        type: 'important'
      }]
    };
    
    updateData(newData);
    setIsCreatingNew(false);
    showMessage(`ìƒˆ í˜¸í…” "${newHotelForm.name}"ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
  };

  // ì¸ë¼ì¸ í¼ ì·¨ì†Œ
  const cancelNewHotel = () => {
    setIsCreatingNew(false);
    setNewHotelForm({
      name: '',
      description: '',
      address: '',
      phone: '',
      checkin_time: '15:00',
      checkout_time: '11:00'
    });
  };

  // í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° (ê°œì„ ëœ ë²„ì „)
  const loadTemplate = async (templateId) => {
    setIsLoading(true);
    try {
      const response = await fetch(`/api/hotels/${templateId}`);
      if (!response.ok) {
        throw new Error(`í…œí”Œë¦¿ ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
      }
      
      const responseData = await response.json();
      const hotel = responseData.hotel || responseData;
      
      console.log('í…œí”Œë¦¿ ë¡œë“œëœ ë°ì´í„°:', hotel);
      
      // ë°ì´í„° êµ¬ì¡° ë³€í™˜ ë° ê²€ì¦
      const transformedData = transformHotelDataToCurrentFormat(hotel);
      
      console.log('ë³€í™˜ëœ ë°ì´í„°:', transformedData);
      
      // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
      const template = templates.find(t => t.id === templateId);
      const packageName = extractPackageFromHotel(hotel);
      const hotelName = hotel.name;
      
      const newProject = {
        id: templateId,
        hotelName: hotelName,
        packageName: packageName,
        fullName: `${hotelName} ${packageName}`,
        loadedAt: new Date().toISOString(),
        lastModified: hotel.updatedAt || hotel.createdAt || new Date().toISOString(),
        isModified: false,
        isNew: false,
        version: '1.0'
      };
      
      setCurrentProject(newProject);
      
      // ë©”ì¸ ì•±ì— ë°ì´í„° ì ìš© (ì „ì²´ ë°ì´í„° ì—…ë°ì´íŠ¸)
      updateData(transformedData);

      showMessage(`"${hotelName} ${packageName}" í…œí”Œë¦¿ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
    } catch (error) {
      console.error('í…œí”Œë¦¿ ë¡œë“œ ì˜¤ë¥˜:', error);
      showMessage(`í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${error.message}`, 'error');
    } finally {
      setIsLoading(false);
    }
  };

  // í˜¸í…” ë°ì´í„° ë³€í™˜ í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
  const transformHotelDataToCurrentFormat = (hotel) => {
    // ê¸°ë³¸ í˜¸í…” ì •ë³´
    const hotelInfo = {
      name: hotel.name || '',
      address: hotel.address || 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
      description: hotel.description || 'í¸ì•ˆí•˜ê³  ì•„ëŠ‘í•œ ë„ì‹¬ ì† íœ´ì‹ê³µê°„ì…ë‹ˆë‹¤.',
      image_url: hotel.imageUrl || '',
      phone: hotel.phone || '02-1234-5678',
      email: hotel.email || '',
      website: hotel.website || '',
      checkin_time: '15:00',
      checkout_time: '11:00'
    };

    // ë£¸ ì •ë³´ ë³€í™˜
    const rooms = hotel.rooms && hotel.rooms.length > 0 ? hotel.rooms.map(room => ({
      roomType: room.type || room.roomType || 'ìŠ¤íƒ ë‹¤ë“œ',
      view: room.view || 'ì‹œí‹°ë·°',
      amenities: room.amenities || ['ë¬´ë£Œ Wi-Fi', 'ì—ì–´ì»¨', 'TV', 'ë¯¸ë‹ˆë°”'],
      roomSize: room.structure || room.roomSize || '25ã¡',
      bedInfo: room.bedType || room.bedInfo || 'í€¸ ë² ë“œ 1ê°œ',
      maxOccupancy: room.maxCapacity || room.maxOccupancy || 2,
      description: room.description || 'í¸ì•ˆí•œ ìˆ™ë©´ì„ ìœ„í•œ í€¸ ë² ë“œê°€ êµ¬ë¹„ëœ ìŠ¤íƒ ë‹¤ë“œ ë£¸ì…ë‹ˆë‹¤.',
      imageUrl: room.image || room.imageUrl || '',
      name: room.name || `${room.type || room.roomType || 'ìŠ¤íƒ ë‹¤ë“œ'} ë£¸`
    })) : [{
      roomType: 'ìŠ¤íƒ ë‹¤ë“œ',
      view: 'ì‹œí‹°ë·°',
      amenities: ['ë¬´ë£Œ Wi-Fi', 'ì—ì–´ì»¨', 'TV', 'ë¯¸ë‹ˆë°”'],
      roomSize: '25ã¡',
      bedInfo: 'í€¸ ë² ë“œ 1ê°œ',
      maxOccupancy: 2,
      description: 'í¸ì•ˆí•œ ìˆ™ë©´ì„ ìœ„í•œ í€¸ ë² ë“œê°€ êµ¬ë¹„ëœ ìŠ¤íƒ ë‹¤ë“œ ë£¸ì…ë‹ˆë‹¤.',
      imageUrl: '',
      name: 'ìŠ¤íƒ ë‹¤ë“œ ë£¸'
    }];

    // íŒ¨í‚¤ì§€ ì •ë³´ ë³€í™˜
    const packages = hotel.packages && hotel.packages.length > 0 ? hotel.packages.map(pkg => ({
      name: pkg.name || 'ê¸°ë³¸ íŒ¨í‚¤ì§€',
      description: pkg.description || 'íŠ¹ë³„í•œ íŒ¨í‚¤ì§€',
      price: pkg.price || 150000,
      includes: pkg.options || pkg.includes || ['ì¡°ì‹', 'ë¬´ë£Œ Wi-Fi'],
      availableFrom: pkg.availableFrom || '2023-01-01',
      availableTo: pkg.availableTo || '2023-12-31'
    })) : [{
      name: extractPackageFromHotel(hotel),
      description: 'ê¸°ë³¸ íŒ¨í‚¤ì§€',
      price: 150000,
      includes: ['ì¡°ì‹', 'ë¬´ë£Œ Wi-Fi'],
      availableFrom: '2023-01-01',
      availableTo: '2023-12-31'
    }];

    // ê°€ê²© ì •ë³´ ë³€í™˜
    const pricing = hotel.priceConfiguration || {
      lodges: [{
        name: hotel.name,
        rooms: rooms.map(room => ({
          roomType: room.roomType,
          view: room.view,
          prices: {
            weekday: 100000,
            friday: 120000,
            saturday: 150000
          }
        }))
      }],
      dayTypes: [
        { id: 'weekday', name: 'ì£¼ì¤‘(ì›”~ëª©)', type: 'weekday' },
        { id: 'friday', name: 'ê¸ˆìš”ì¼', type: 'friday' },
        { id: 'saturday', name: 'í† ìš”ì¼', type: 'saturday' }
      ]
    };

    return {
      hotel: hotelInfo,
      rooms: rooms,
      packages: packages,
      facilities: hotel.facilities || {
        general: ['ë¬´ë£Œ Wi-Fi', '24ì‹œê°„ í”„ëŸ°íŠ¸ ë°ìŠ¤í¬', 'ì—˜ë¦¬ë² ì´í„°'],
        business: ['ë¹„ì¦ˆë‹ˆìŠ¤ ì„¼í„°', 'íšŒì˜ì‹¤'],
        leisure: ['í”¼íŠ¸ë‹ˆìŠ¤ ì„¼í„°', 'ì‚¬ìš°ë‚˜'],
        dining: ['ë ˆìŠ¤í† ë‘', 'ì¹´í˜', 'ë£¸ì„œë¹„ìŠ¤']
      },
      checkin: hotel.checkin || {
        checkInTime: '15:00',
        checkOutTime: '11:00',
        earlyCheckIn: 'ì¶”ê°€ ìš”ê¸ˆ ë°œìƒ',
        lateCheckOut: 'ì¶”ê°€ ìš”ê¸ˆ ë°œìƒ'
      },
      pricing: pricing,
      cancel: hotel.cancel || {
        freeCancellation: 'ì²´í¬ì¸ 7ì¼ ì „ê¹Œì§€ ë¬´ë£Œ ì·¨ì†Œ',
        cancellationFee: 'ì²´í¬ì¸ 3ì¼ ì „~ë‹¹ì¼: ì²«ë‚  ìš”ê¸ˆì˜ 100%',
        noShow: 'ë…¸ì‡¼ ì‹œ ì „ì•¡ ì²­êµ¬',
        modificationPolicy: 'ë‚ ì§œ ë³€ê²½ì€ ì²´í¬ì¸ 3ì¼ ì „ê¹Œì§€ ê°€ëŠ¥'
      },
      booking: hotel.booking || {
        reservationMethod: 'ì˜¨ë¼ì¸ ì˜ˆì•½ ì‹œìŠ¤í…œ',
        paymentMethods: ['ì‹ ìš©ì¹´ë“œ', 'ê³„ì¢Œì´ì²´', 'í˜„ê¸ˆ'],
        confirmationTime: 'ì˜ˆì•½ í›„ 24ì‹œê°„ ì´ë‚´ í™•ì¸',
        specialRequests: 'ì²´í¬ì¸ ì‹œ ìš”ì²­ì‚¬í•­ ì „ë‹¬ ê°€ëŠ¥'
      },
      notices: hotel.notices && hotel.notices.length > 0 ? hotel.notices.map(notice => ({
        title: notice.title || 'ì¤‘ìš” ì•ˆë‚´',
        content: notice.content || 'ì²´í¬ì¸ ì‹œ ì‹ ë¶„ì¦ì„ ì§€ì°¸í•´ ì£¼ì„¸ìš”.',
        type: notice.type || 'important'
      })) : [{
        title: 'ì¤‘ìš” ì•ˆë‚´',
        content: 'ì²´í¬ì¸ ì‹œ ì‹ ë¶„ì¦ì„ ì§€ì°¸í•´ ì£¼ì„¸ìš”.',
        type: 'important'
      }]
    };
  };

  // í”„ë¡œì íŠ¸ ì €ì¥ (ìƒˆë¡œ ì €ì¥)
  const saveAsNewProject = async () => {
    if (!currentProject) {
      showMessage('ì €ì¥í•  í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
      return;
    }

    setIsLoading(true);
    try {
      // ì €ì¥í•  ë°ì´í„° ì¤€ë¹„
      const saveData = {
        name: currentProject.hotelName,
        address: currentData.hotel?.address || 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
        description: currentData.hotel?.description || 'í¸ì•ˆí•˜ê³  ì•„ëŠ‘í•œ ë„ì‹¬ ì† íœ´ì‹ê³µê°„ì…ë‹ˆë‹¤.',
        imageUrl: currentData.hotel?.image_url || '',
        phone: currentData.hotel?.phone || '02-1234-5678',
        email: currentData.hotel?.email || '',
        website: currentData.hotel?.website || '',
        rooms: currentData.rooms || [],
        packages: currentData.packages || [],
        facilities: currentData.facilities || {},
        checkin: currentData.checkin || {},
        priceConfiguration: currentData.pricing || {},
        cancel: currentData.cancel || {},
        booking: currentData.booking || {},
        notices: currentData.notices || []
      };

      const response = await fetch('/api/hotels', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(saveData)
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`ì €ì¥ ì‹¤íŒ¨: ${response.status} - ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
      }

      const result = await response.json();
      
      // í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
      const updatedProject = {
        ...currentProject,
        id: result.hotel?.id || result.id,
        lastModified: new Date().toISOString(),
        isNew: false,
        isModified: false
      };

      setCurrentProject(updatedProject);
      showMessage(`"${currentProject.fullName}"ì„ ìƒˆ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤`, 'success');
      
      // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadHotels();
    } catch (error) {
      console.error('í”„ë¡œì íŠ¸ ì €ì¥ ì˜¤ë¥˜:', error);
      showMessage(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
    } finally {
      setIsLoading(false);
    }
  };

  // ê¸°ì¡´ í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸
  const updateExistingProject = async () => {
    if (!currentProject?.id) {
      showMessage('ì—…ë°ì´íŠ¸í•  í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
      return;
    }

    setIsLoading(true);
    try {
      // ì—…ë°ì´íŠ¸í•  ë°ì´í„° ì¤€ë¹„
      const updateData = {
        name: currentProject.hotelName,
        address: currentData.hotel?.address || '',
        description: currentData.hotel?.description || '',
        image_url: currentData.hotel?.image_url || currentData.hotel?.imageUrl || '',
        phone_number: currentData.hotel?.phone || '',
        email: currentData.hotel?.email || '',
        website: currentData.hotel?.website || '',
        rooms: currentData.rooms || [],
        packages: currentData.packages || [],
        notices: currentData.notices || []
      };

      const response = await fetch(`/api/hotels/${currentProject.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updateData)
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${response.status} - ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
      }

      const result = await response.json();
      
      // í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
      const updatedProject = {
        ...currentProject,
        lastModified: new Date().toISOString(),
        isModified: false
      };

      setCurrentProject(updatedProject);
      showMessage(`"${currentProject.fullName}"ì„ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤`, 'success');
      
      // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadHotels();
    } catch (error) {
      console.error('í”„ë¡œì íŠ¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
      showMessage(`ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
    } finally {
      setIsLoading(false);
    }
  };

  // í…œí”Œë¦¿ ë³µì‚¬í•´ì„œ ìƒˆ í”„ë¡œì íŠ¸ ì‹œì‘
  const copyTemplate = async (templateId) => {
    await loadTemplate(templateId);
    
    // ë³µì‚¬ëœ ê²ƒìœ¼ë¡œ í‘œì‹œ
    if (currentProject) {
      const copiedProject = {
        ...currentProject,
        hotelName: currentProject.hotelName,
        packageName: currentProject.packageName,
        fullName: `${currentProject.hotelName} ${currentProject.packageName}`,
        isNew: true,
        isModified: true,
        version: '1.0',
        baseTemplateId: templateId,
        id: null // ìƒˆë¡œ ì €ì¥ë  ë•Œê¹Œì§€ ID ì œê±°
      };
      
      setCurrentProject(copiedProject);
      showMessage(`"${currentProject.fullName}"ì„ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ì €ì¥í•˜ì„¸ìš”.`, 'info');
    }
  };

  // í”„ë¡œì íŠ¸ ì‚­ì œ
  const deleteProject = async (projectId) => {
    const template = templates.find(t => t.id === projectId);
    if (!confirm(`"${template?.fullName}" í…œí”Œë¦¿ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

    setIsLoading(true);
    try {
      const response = await fetch(`/api/hotels?id=${projectId}`, {
        method: 'DELETE'
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(`ì‚­ì œ ì‹¤íŒ¨: ${response.status} - ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
      }

      showMessage(`"${template?.fullName}" í…œí”Œë¦¿ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤`, 'success');
      
      // í˜„ì¬ í”„ë¡œì íŠ¸ê°€ ì‚­ì œëœ í”„ë¡œì íŠ¸ì¸ê²½ìš° ì´ˆê¸°í™”
      if (currentProject?.id === projectId) {
        setCurrentProject(null);
      }
      
      // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
      await loadHotels();
    } catch (error) {
      console.error('í”„ë¡œì íŠ¸ ì‚­ì œ ì˜¤ë¥˜:', error);
      showMessage(`ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
    } finally {
      setIsLoading(false);
    }
  };

  // í˜¸í…”ëª… ë³€ê²½ (ê°œì„ ëœ ë²„ì „)
  const changeHotelName = (newHotelName) => {
    if (!newHotelName.trim()) {
      showMessage('í˜¸í…”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
      return;
    }

    // í˜„ì¬ ë°ì´í„° ì—…ë°ì´íŠ¸
    const updatedData = {
      ...currentData,
      hotel: {
        ...currentData.hotel,
        name: newHotelName.trim()
      }
    };

    updateData(updatedData);
    
    // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ë„ ì—…ë°ì´íŠ¸
    if (currentProject) {
      const updatedProject = {
        ...currentProject,
        hotelName: newHotelName.trim(),
        fullName: `${newHotelName.trim()} ${currentProject.packageName}`,
        isModified: true
      };
      
      setCurrentProject(updatedProject);
      
      // localStorageì— ì €ì¥
      try {
        localStorage.setItem('currentProject', JSON.stringify(updatedProject));
      } catch (error) {
        console.error('currentProject ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
    
    showMessage(`í˜¸í…”ëª…ì„ "${newHotelName}"ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤`, 'success');
  };

  // íŒ¨í‚¤ì§€ëª… ë³€ê²½ (ê°œì„ ëœ ë²„ì „)
  const changePackageName = (newPackageName) => {
    if (!newPackageName.trim()) {
      showMessage('íŒ¨í‚¤ì§€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
      return;
    }

    // í˜„ì¬ ë°ì´í„° ì—…ë°ì´íŠ¸
    const updatedData = {
      ...currentData,
      packages: currentData.packages.length > 0 
        ? currentData.packages.map((pkg, index) => 
            index === 0 
              ? { ...pkg, name: newPackageName.trim() }
              : pkg
          )
        : [{
            name: newPackageName.trim(),
            description: 'ìƒˆ íŒ¨í‚¤ì§€',
            price: 150000,
            includes: ['ì¡°ì‹', 'ë¬´ë£Œ Wi-Fi'],
            availableFrom: '2023-01-01',
            availableTo: '2023-12-31'
          }]
    };

    updateData(updatedData);
    
    // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ë„ ì—…ë°ì´íŠ¸
    if (currentProject) {
      const updatedProject = {
        ...currentProject,
        packageName: newPackageName.trim(),
        fullName: `${currentProject.hotelName} ${newPackageName.trim()}`,
        isModified: true
      };
      
      setCurrentProject(updatedProject);
      
      // localStorageì— ì €ì¥
      try {
        localStorage.setItem('currentProject', JSON.stringify(updatedProject));
      } catch (error) {
        console.error('currentProject ì €ì¥ ì‹¤íŒ¨:', error);
      }
    }
    
    showMessage(`íŒ¨í‚¤ì§€ëª…ì„ "${newPackageName}"ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤`, 'success');
  };

  // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì´ˆê¸°í™”
  useEffect(() => {
    loadHotels();
    checkDatabaseStatus();
  }, []);

  // í˜„ì¬ ë°ì´í„° ë³€ê²½ ê°ì§€ ë° ë™ê¸°í™”
  useEffect(() => {
    if (currentProject && currentData) {
      // í˜„ì¬ ë°ì´í„°ì—ì„œ í˜¸í…”ëª…ê³¼ íŒ¨í‚¤ì§€ëª… ì¶”ì¶œ
      const currentHotelName = currentData.hotel?.name || '';
      const currentPackageName = extractPackageName(currentData);
      
      // í”„ë¡œì íŠ¸ ì •ë³´ì™€ ë‹¤ë¥´ë©´ ì—…ë°ì´íŠ¸
      if (currentProject.hotelName !== currentHotelName || 
          currentProject.packageName !== currentPackageName) {
        
        const updatedProject = {
          ...currentProject,
          hotelName: currentHotelName,
          packageName: currentPackageName,
          fullName: `${currentHotelName} ${currentPackageName}`.trim(),
          isModified: true,
          lastModified: new Date().toISOString()
        };
        
        console.log('í”„ë¡œì íŠ¸ ì •ë³´ ë™ê¸°í™”:', updatedProject);
        setCurrentProject(updatedProject);
        
        // localStorage ì—…ë°ì´íŠ¸
        try {
          localStorage.setItem('currentProject', JSON.stringify(updatedProject));
        } catch (error) {
          console.error('localStorage ì €ì¥ ì‹¤íŒ¨:', error);
        }
      }
    }
  }, [currentData]);

  // í˜„ì¬ í”„ë¡œì íŠ¸ ìƒíƒœ ê³„ì‚°
  const getProjectStatus = () => {
    if (!currentProject) return { text: 'í”„ë¡œì íŠ¸ ì—†ìŒ', color: '#6b7280' };
    
    if (currentProject.isNew) {
      return { text: 'ìƒˆ í”„ë¡œì íŠ¸', color: '#10b981' };
    }
    
    if (currentProject.isModified) {
      return { text: 'ìˆ˜ì •ë¨', color: '#f59e0b' };
    }
    
    return { text: 'ì €ì¥ë¨', color: '#3b82f6' };
  };

  const projectStatus = getProjectStatus();

  return (
    <div style={{ 
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      borderRadius: '15px',
      padding: '20px',
      color: 'white',
      fontFamily: 'Inter, sans-serif'
    }}>
      {/* í—¤ë” */}
      <div style={{ marginBottom: '25px' }}>
        <h3 style={{ 
          margin: '0 0 10px 0', 
          fontSize: '24px', 
          fontWeight: '700',
          display: 'flex',
          alignItems: 'center',
          gap: '10px'
        }}>
          ğŸ¨ í”„ë¡œì íŠ¸ ê´€ë¦¬
          {dbStatus && (
            <span style={{ 
              fontSize: '12px', 
              background: 'rgba(255,255,255,0.2)', 
              padding: '4px 8px', 
              borderRadius: '12px',
              fontWeight: 'normal'
            }}>
              {dbStatus.statistics?.hotels || 0}ê°œ í…œí”Œë¦¿
            </span>
          )}
        </h3>
        
        {/* ë©”ì‹œì§€ í‘œì‹œ */}
        {message && (
          <div style={{ 
            padding: '12px 16px',
            borderRadius: '8px',
            marginBottom: '15px',
            background: message.type === 'error' ? 'rgba(239, 68, 68, 0.9)' :
                       message.type === 'success' ? 'rgba(34, 197, 94, 0.9)' :
                       'rgba(59, 130, 246, 0.9)',
            fontSize: '14px',
            fontWeight: '500'
          }}>
            {message.text}
          </div>
        )}
      </div>

      {/* í˜„ì¬ ì‘ì—… í”„ë¡œì íŠ¸ */}
      {currentProject && (
        <div style={{ 
          background: 'rgba(255,255,255,0.15)', 
          borderRadius: '12px', 
          padding: '20px',
          marginBottom: '25px',
          border: '1px solid rgba(255,255,255,0.2)'
        }}>
          <h4 style={{ 
            margin: '0 0 15px 0', 
            fontSize: '18px', 
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '10px'
          }}>
            ğŸ“‹ í˜„ì¬ ì‘ì—…: {currentProject.fullName}
            <span style={{ 
              fontSize: '12px',
              background: projectStatus.color,
              color: 'white',
              padding: '4px 8px',
              borderRadius: '12px',
              fontWeight: 'normal'
            }}>
              {projectStatus.text}
            </span>
          </h4>
          
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
            gap: '15px',
            marginBottom: '20px'
          }}>
            <div>
              <label style={{ display: 'block', fontSize: '14px', marginBottom: '8px', opacity: 0.9 }}>
                ğŸ¨ í˜¸í…”ëª…
              </label>
              <input
                type="text"
                value={currentProject.hotelName}
                onChange={(e) => changeHotelName(e.target.value)}
                placeholder="í˜¸í…”ëª… ì…ë ¥"
                style={{
                  width: '100%',
                  padding: '10px 12px',
                  borderRadius: '8px',
                  border: '1px solid rgba(255,255,255,0.3)',
                  background: 'rgba(255,255,255,0.1)',
                  color: 'white',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              />
            </div>
            
            <div>
              <label style={{ display: 'block', fontSize: '14px', marginBottom: '8px', opacity: 0.9 }}>
                ğŸ“¦ íŒ¨í‚¤ì§€ëª…
              </label>
              <input
                type="text"
                value={currentProject.packageName}
                onChange={(e) => changePackageName(e.target.value)}
                placeholder="íŒ¨í‚¤ì§€ëª… ì…ë ¥"
                style={{
                  width: '100%',
                  padding: '10px 12px',
                  borderRadius: '8px',
                  border: '1px solid rgba(255,255,255,0.3)',
                  background: 'rgba(255,255,255,0.1)',
                  color: 'white',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              />
            </div>
          </div>
          
          <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
            <button
              onClick={saveAsNewProject}
              disabled={isLoading}
              style={{
                background: 'rgba(34, 197, 94, 0.8)',
                border: 'none',
                borderRadius: '8px',
                padding: '10px 16px',
                color: 'white',
                fontWeight: '600',
                cursor: isLoading ? 'not-allowed' : 'pointer',
                fontSize: '14px',
                display: 'flex',
                alignItems: 'center',
                gap: '6px',
                opacity: isLoading ? 0.7 : 1
              }}
            >
              ğŸ’¾ ìƒˆë¡œ ì €ì¥
            </button>
            
            {currentProject.id && !currentProject.isNew && (
              <button
                onClick={updateExistingProject}
                disabled={isLoading || !currentProject.isModified}
                style={{
                  background: currentProject.isModified ? 'rgba(245, 158, 11, 0.8)' : 'rgba(107, 114, 128, 0.5)',
                  border: 'none',
                  borderRadius: '8px',
                  padding: '10px 16px',
                  color: 'white',
                  fontWeight: '600',
                  cursor: (isLoading || !currentProject.isModified) ? 'not-allowed' : 'pointer',
                  fontSize: '14px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '6px',
                  opacity: (isLoading || !currentProject.isModified) ? 0.7 : 1
                }}
              >
                ğŸ”„ ì—…ë°ì´íŠ¸
              </button>
            )}
          </div>
          
          {currentProject.lastModified && (
            <div style={{ 
              fontSize: '12px', 
              opacity: 0.8, 
              marginTop: '12px',
              display: 'flex',
              alignItems: 'center',
              gap: '6px'
            }}>
              ğŸ•’ ìµœê·¼ ìˆ˜ì •: {new Date(currentProject.lastModified).toLocaleString('ko-KR')}
            </div>
          )}
        </div>
      )}

      {/* ìµœê·¼ ì‘ì—… ëª©ë¡ */}
      {recentProjects.length > 0 && (
        <div style={{ marginBottom: '25px' }}>
          <h4 style={{ 
            margin: '0 0 15px 0', 
            fontSize: '18px', 
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px'
          }}>
            ğŸ•’ ìµœê·¼ ì‘ì—…
          </h4>
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', 
            gap: '12px' 
          }}>
            {recentProjects.slice(0, 6).map((project, index) => (
              <div
                key={index}
                onClick={() => project.id && loadTemplate(project.id)}
                style={{
                  padding: '12px 15px',
                  background: 'rgba(255,255,255,0.1)',
                  border: '1px solid rgba(255,255,255,0.2)',
                  borderRadius: '8px',
                  cursor: 'pointer',
                  transition: 'all 0.2s',
                  fontSize: '14px'
                }}
                onMouseEnter={(e) => {
                  e.target.style.background = 'rgba(255,255,255,0.2)';
                }}
                onMouseLeave={(e) => {
                  e.target.style.background = 'rgba(255,255,255,0.1)';
                }}
              >
                <div style={{ fontWeight: '600', marginBottom: '6px' }}>
                  {project.fullName}
                </div>
                <div style={{ fontSize: '12px', opacity: 0.8 }}>
                  ğŸ“… {new Date(project.lastModified).toLocaleDateString('ko-KR')}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* ì¡°ì‘ ë²„íŠ¼ë“¤ ë° ì¸ë¼ì¸ í˜¸í…” ìƒì„± í¼ */}
      <div style={{ marginBottom: '25px' }}>
        {/* ë²„íŠ¼ë“¤ */}
        <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap', marginBottom: isCreatingNew ? '20px' : '0' }}>
          <button
            onClick={startNewProject}
            disabled={isLoading || isCreatingNew}
            style={{
              background: isCreatingNew ? 'rgba(107, 114, 128, 0.5)' : 'rgba(34, 197, 94, 0.8)',
              border: 'none',
              borderRadius: '8px',
              padding: '12px 20px',
              color: 'white',
              fontWeight: '600',
              cursor: (isLoading || isCreatingNew) ? 'not-allowed' : 'pointer',
              fontSize: '14px',
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              opacity: (isLoading || isCreatingNew) ? 0.7 : 1
            }}
          >
            â• ìƒˆ í˜¸í…” ìƒì„±
          </button>
        
        <button
          onClick={loadHotels}
          disabled={isLoading}
          style={{
            background: 'rgba(59, 130, 246, 0.8)',
            border: 'none',
            borderRadius: '8px',
            padding: '12px 20px',
            color: 'white',
            fontWeight: '600',
            cursor: isLoading ? 'not-allowed' : 'pointer',
            fontSize: '14px',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            opacity: isLoading ? 0.7 : 1
          }}
        >
          ğŸ”„ ìƒˆë¡œê³ ì¹¨
        </button>
      </div>

      {/* í…œí”Œë¦¿ ëª©ë¡ */}
      <div>
        <h4 style={{ 
          margin: '0 0 15px 0', 
          fontSize: '18px', 
          fontWeight: '600',
          display: 'flex',
          alignItems: 'center',
          gap: '8px'
        }}>
          ğŸ“š ì €ì¥ëœ í…œí”Œë¦¿
        </h4>
        
        {isLoading ? (
          <div style={{ 
            textAlign: 'center', 
            padding: '40px 0',
            fontSize: '16px'
          }}>
            ğŸ”„ ë¡œë”© ì¤‘...
          </div>
        ) : templates.length === 0 ? (
          <div style={{ 
            textAlign: 'center', 
            padding: '40px 0',
            fontSize: '16px',
            opacity: 0.8
          }}>
            ğŸ“ ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        ) : (
          <div style={{ 
            display: 'grid', 
            gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', 
            gap: '15px' 
          }}>
            {templates.map((template) => (
              <div
                key={template.id}
                style={{
                  padding: '18px',
                  background: 'rgba(255,255,255,0.1)',
                  border: '1px solid rgba(255,255,255,0.2)',
                  borderRadius: '12px',
                  transition: 'all 0.2s'
                }}
              >
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'flex-start',
                  marginBottom: '12px'
                }}>
                  <h5 style={{ 
                    margin: 0, 
                    fontSize: '16px', 
                    fontWeight: '600',
                    lineHeight: '1.3'
                  }}>
                    {template.fullName}
                  </h5>
                  <div style={{ 
                    display: 'flex', 
                    gap: '4px',
                    fontSize: '14px',
                    opacity: 0.8
                  }}>
                    {template.hasRooms && <span>ğŸ </span>}
                    {template.hasPackages && <span>ğŸ“¦</span>}
                  </div>
                </div>
                
                <div style={{ 
                  fontSize: '14px', 
                  marginBottom: '15px',
                  opacity: 0.9,
                  lineHeight: '1.4'
                }}>
                  <div style={{ marginBottom: '4px' }}>ğŸ¨ {template.hotelName}</div>
                  <div style={{ marginBottom: '4px' }}>ğŸ“¦ {template.packageName}</div>
                  <div style={{ fontSize: '12px', opacity: 0.7 }}>
                    ğŸ“… {new Date(template.lastModified).toLocaleDateString('ko-KR', {
                      year: 'numeric',
                      month: 'short',
                      day: 'numeric'
                    })}
                  </div>
                </div>
                
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button
                    onClick={() => loadTemplate(template.id)}
                    style={{
                      flex: 1,
                      padding: '8px 12px',
                      background: 'rgba(59, 130, 246, 0.8)',
                      border: 'none',
                      borderRadius: '6px',
                      color: 'white',
                      fontSize: '13px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.background = 'rgba(59, 130, 246, 1)';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.background = 'rgba(59, 130, 246, 0.8)';
                    }}
                  >
                    ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°
                  </button>
                  <button
                    onClick={() => copyTemplate(template.id)}
                    style={{
                      padding: '8px 12px',
                      background: 'rgba(34, 197, 94, 0.8)',
                      border: 'none',
                      borderRadius: '6px',
                      color: 'white',
                      fontSize: '13px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.background = 'rgba(34, 197, 94, 1)';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.background = 'rgba(34, 197, 94, 0.8)';
                    }}
                  >
                    ğŸ“„ ë³µì‚¬
                  </button>
                  <button
                    onClick={() => deleteProject(template.id)}
                    style={{
                      padding: '8px 12px',
                      background: 'rgba(239, 68, 68, 0.8)',
                      border: 'none',
                      borderRadius: '6px',
                      color: 'white',
                      fontSize: '13px',
                      fontWeight: '600',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => {
                      e.target.style.background = 'rgba(239, 68, 68, 1)';
                    }}
                    onMouseLeave={(e) => {
                      e.target.style.background = 'rgba(239, 68, 68, 0.8)';
                    }}
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ */}
      {dbStatus && (
        <div style={{ 
          marginTop: '25px',
          padding: '15px',
          background: 'rgba(255,255,255,0.1)',
          border: '1px solid rgba(255,255,255,0.2)',
          borderRadius: '10px'
        }}>
          <h4 style={{ 
            margin: '0 0 10px 0', 
            fontSize: '16px', 
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px'
          }}>
            ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ
          </h4>
          <div style={{ 
            fontSize: '14px',
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
            gap: '10px',
            opacity: 0.9
          }}>
            <div>ğŸ“š ì´ í…œí”Œë¦¿: {dbStatus.statistics?.hotels || 0}ê°œ</div>
            <div>
              ğŸ”— DB ìƒíƒœ: {dbStatus.success ? (
                <span style={{ color: '#10b981' }}>âœ… ì •ìƒ</span>
              ) : (
                <span style={{ color: '#ef4444' }}>âŒ ì˜¤ë¥˜</span>
              )}
            </div>
          </div>
        </div>
      )}
    </div>
  );
} 