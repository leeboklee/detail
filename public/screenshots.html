<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스크린샷 관리자</title>
    <link rel="stylesheet" href="/static/styles/main.css">
    <style>
        .screenshots-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .screenshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .screenshot-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            background: white;
        }
        
        .screenshot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .screenshot-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }
        
        .screenshot-info {
            padding: 15px;
        }
        
        .screenshot-timestamp {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .screenshot-filename {
            font-weight: bold;
            margin-bottom: 10px;
            word-break: break-all;
        }
        
        .screenshot-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .screenshot-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        
        .view-btn {
            background-color: #0078ff;
            color: white;
        }
        
        .view-btn:hover {
            background-color: #0056b3;
        }
        
        .logs-btn {
            background-color: #17a2b8;
            color: white;
        }
        
        .logs-btn:hover {
            background-color: #138496;
        }
        
        .delete-btn {
            background-color: #dc3545;
            color: white;
        }
        
        .delete-btn:hover {
            background-color: #bd2130;
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #666;
        }
        
        .screenshot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .modal-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        
        .close-modal {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }
        
        .loading {
            text-align: center;
            padding: 50px 20px;
        }
        
        /* 다크모드 */
        body.dark-mode .screenshot-card {
            background-color: #333;
            border-color: #444;
        }
        
        body.dark-mode .screenshot-image {
            border-color: #444;
        }
        
        body.dark-mode .screenshot-timestamp,
        body.dark-mode .screenshot-filename {
            color: #e0e0e0;
        }
        
        body.dark-mode .empty-state {
            color: #e0e0e0;
        }
        
        .logs-container {
            margin-top: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 10px;
            font-size: 0.9em;
            max-height: 150px;
            overflow-y: auto;
            display: none;
        }
        
        body.dark-mode .logs-container {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }
        
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        body.dark-mode .log-entry {
            border-color: #444;
        }
    </style>
</head>
<body>
    <header id="header"></header>
    <main id="main-container" class="main-container">
        <div class="screenshots-container">
            <h1>스크린샷 관리자</h1>
            <p>브라우저 화면 캡처 이미지 목록입니다.</p>
            
            <div class="loading" id="loading">
                <p>스크린샷 로딩 중...</p>
            </div>
            
            <div class="empty-state" id="empty-state" style="display: none;">
                <p>저장된 스크린샷이 없습니다.</p>
                <p>페이지에서 화면 캡처 버튼을 클릭하여 스크린샷을 저장하세요.</p>
            </div>
            
            <div class="screenshot-grid" id="screenshot-grid"></div>
        </div>
        
        <!-- 이미지 확대 모달 -->
        <div class="screenshot-modal" id="screenshot-modal">
            <div class="modal-content">
                <span class="close-modal" id="close-modal">&times;</span>
                <img src="" alt="스크린샷 확대" class="modal-image" id="modal-image">
            </div>
        </div>
    </main>
    <footer id="footer">
        <div class="footer-content">
            <p>&copy; 2023 스크린샷 관리 시스템</p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const screenshotGrid = document.getElementById('screenshot-grid');
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('empty-state');
            const modal = document.getElementById('screenshot-modal');
            const modalImage = document.getElementById('modal-image');
            const closeModal = document.getElementById('close-modal');
            
            // 모달 닫기
            closeModal.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // 모달 외부 클릭 시 닫기
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // 스크린샷 목록 로드
            async function loadScreenshots() {
                try {
                    const response = await fetch('/api/debug/screenshots');
                    const data = await response.json();
                    
                    loading.style.display = 'none';
                    
                    if (data.status === 'success') {
                        if (data.count > 0) {
                            renderScreenshots(data.screenshots);
                        } else {
                            emptyState.style.display = 'block';
                        }
                    } else {
                        showError('스크린샷 로드 중 오류가 발생했습니다.');
                    }
                } catch (error) {
                    loading.style.display = 'none';
                    showError('서버 통신 중 오류가 발생했습니다.');
                    console.error('스크린샷 로드 오류:', error);
                }
            }
            
            // 스크린샷 목록 렌더링
            function renderScreenshots(screenshots) {
                screenshotGrid.innerHTML = '';
                
                screenshots.forEach(screenshot => {
                    const card = document.createElement('div');
                    card.className = 'screenshot-card';
                    
                    // 타임스탬프를 사용자 친화적인 형식으로 변환
                    const date = new Date(screenshot.timestamp);
                    const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`;
                    
                    // 파일 크기를 사용자 친화적인 형식으로 변환
                    const fileSize = formatFileSize(screenshot.fileSize);
                    
                    card.innerHTML = `
                        <img src="/api/debug/screenshots/${screenshot.fileName}" alt="스크린샷" class="screenshot-image">
                        <div class="screenshot-info">
                            <div class="screenshot-timestamp">${formattedDate}</div>
                            <div class="screenshot-filename">${screenshot.fileName}</div>
                            <div>크기: ${fileSize}</div>
                            <div class="screenshot-actions">
                                <button class="screenshot-btn view-btn" data-filename="${screenshot.fileName}">보기</button>
                                ${screenshot.hasLogs ? `<button class="screenshot-btn logs-btn" data-logfile="${screenshot.logFile}">로그</button>` : ''}
                            </div>
                            ${screenshot.hasLogs ? `<div class="logs-container" id="logs-${screenshot.fileName.replace('.png', '')}"></div>` : ''}
                        </div>
                    `;
                    
                    screenshotGrid.appendChild(card);
                });
                
                // 보기 버튼 이벤트 할당
                document.querySelectorAll('.view-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const filename = this.getAttribute('data-filename');
                        modalImage.src = `/api/debug/screenshots/${filename}`;
                        modal.style.display = 'flex';
                    });
                });
                
                // 로그 버튼 이벤트 할당
                document.querySelectorAll('.logs-btn').forEach(button => {
                    button.addEventListener('click', async function() {
                        const logfile = this.getAttribute('data-logfile');
                        const logsContainer = this.closest('.screenshot-info').querySelector('.logs-container');
                        
                        if (logsContainer.style.display === 'block') {
                            logsContainer.style.display = 'none';
                            return;
                        }
                        
                        // 로그 데이터가 없으면 로드
                        if (logsContainer.innerHTML === '') {
                            try {
                                const response = await fetch(`/api/debug/screenshots/${logfile}`);
                                const logData = await response.json();
                                
                                let logsHtml = '';
                                if (Array.isArray(logData)) {
                                    logData.forEach(log => {
                                        logsHtml += `<div class="log-entry">${log.level}: ${log.message}</div>`;
                                    });
                                } else if (logData.logs && Array.isArray(logData.logs)) {
                                    logData.logs.forEach(log => {
                                        logsHtml += `<div class="log-entry">${log.level}: ${log.message}</div>`;
                                    });
                                } else {
                                    logsHtml = '<div class="log-entry">로그 데이터 형식이 잘못되었습니다.</div>';
                                }
                                
                                logsContainer.innerHTML = logsHtml || '<div class="log-entry">로그 데이터가 없습니다.</div>';
                            } catch (error) {
                                logsContainer.innerHTML = '<div class="log-entry">로그 로드 중 오류가 발생했습니다.</div>';
                                console.error('로그 로드 오류:', error);
                            }
                        }
                        
                        logsContainer.style.display = 'block';
                    });
                });
            }
            
            // 파일 크기 포맷팅
            function formatFileSize(bytes) {
                if (bytes < 1024) {
                    return bytes + ' B';
                } else if (bytes < 1024 * 1024) {
                    return (bytes / 1024).toFixed(2) + ' KB';
                } else {
                    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
                }
            }
            
            // 오류 표시
            function showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.style.color = '#dc3545';
                errorDiv.style.margin = '20px 0';
                errorDiv.style.padding = '10px';
                errorDiv.style.backgroundColor = '#f8d7da';
                errorDiv.style.borderRadius = '4px';
                errorDiv.style.textAlign = 'center';
                errorDiv.textContent = message;
                
                // 다크모드 대응
                if (document.body.classList.contains('dark-mode')) {
                    errorDiv.style.backgroundColor = '#42252b';
                }
                
                screenshotGrid.before(errorDiv);
            }
            
            // 스크린샷 목록 로드
            loadScreenshots();
        });
    </script>

    <!-- 메인 스크립트 -->
    <script src="/static/scripts/main.js"></script>
</body>
</html> 