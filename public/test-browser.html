<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>호텔 관리 시스템 기능 테스트</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .input-group textarea {
            height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">🧪 호텔 관리 시스템 기능 테스트</h1>
        
        <div class="test-section">
            <h2>📅 판매기간&투숙일 데이터 입력</h2>
            <div class="input-group">
                <label>판매 시작일:</label>
                <input type="date" id="saleStartDate" value="2024-02-01">
            </div>
            <div class="input-group">
                <label>판매 종료일:</label>
                <input type="date" id="saleEndDate" value="2024-02-29">
            </div>
            <div class="input-group">
                <label>투숙 시작일:</label>
                <input type="date" id="stayStartDate" value="2024-03-01">
            </div>
            <div class="input-group">
                <label>투숙 종료일:</label>
                <input type="date" id="stayEndDate" value="2024-03-31">
            </div>
            <div class="input-group">
                <label>얼리버드 할인:</label>
                <input type="text" id="earlyBirdDiscount" value="30일 전 예약 시 10% 할인" placeholder="할인 정보 입력">
            </div>
            <div class="input-group">
                <label>체크인 시간:</label>
                <input type="time" id="checkInTime" value="15:00">
            </div>
            <div class="input-group">
                <label>체크아웃 시간:</label>
                <input type="time" id="checkOutTime" value="11:00">
            </div>
            <div class="input-group">
                <label>특별 혜택:</label>
                <textarea id="specialBenefits" placeholder="조식 무료 제공, 스파 이용권 등">조식 무료 제공, 웰컴 드링크 서비스</textarea>
            </div>
        </div>
        
        <div class="test-section">
            <h2>🧪 기능 테스트</h2>
            <button class="test-button" onclick="testSaveSession()">💾 DB 저장 테스트</button>
            <button class="test-button" onclick="testLoadSession()">📁 DB 불러오기 테스트</button>
            <button class="test-button" onclick="testTemplates()">📋 템플릿 불러오기 테스트</button>
            <button class="test-button" onclick="testHTMLGeneration()">🏗️ HTML 생성 테스트</button>
            <button class="test-button" onclick="openMainApp()">🚀 메인 앱 열기</button>
            <div id="testResults" class="result-box"></div>
        </div>
        
        <div class="test-section">
            <h2>📋 테스트 결과 요약</h2>
            <div id="testSummary" class="result-box">테스트를 실행하면 여기에 결과가 표시됩니다.</div>
        </div>
    </div>

    <script>
        let lastSessionId = null;
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const resultBox = document.getElementById('testResults');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            resultBox.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            resultBox.scrollTop = resultBox.scrollHeight;
        }

        function updateSummary() {
            const summary = document.getElementById('testSummary');
            const total = testResults.length;
            const passed = testResults.filter(r => r.status === 'success').length;
            const failed = testResults.filter(r => r.status === 'error').length;
            
            summary.innerHTML = `총 테스트: ${total}개
성공: ${passed}개
실패: ${failed}개

상세 결과:
${testResults.map(r => `${r.status === 'success' ? '✅' : '❌'} ${r.name}: ${r.message}`).join('\n')}`;
        }

        function getFormData() {
            return {
                period: {
                    saleStartDate: document.getElementById('saleStartDate').value,
                    saleEndDate: document.getElementById('saleEndDate').value,
                    stayStartDate: document.getElementById('stayStartDate').value,
                    stayEndDate: document.getElementById('stayEndDate').value,
                    earlyBirdDiscount: document.getElementById('earlyBirdDiscount').value,
                    checkInTime: document.getElementById('checkInTime').value,
                    checkOutTime: document.getElementById('checkOutTime').value,
                    specialBenefits: document.getElementById('specialBenefits').value
                }
            };
        }

        async function testSaveSession() {
            log('🧪 DB 저장 테스트 시작...');
            try {
                const data = getFormData();
                const response = await fetch('/api/saveSession', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: 'browser-test-' + Date.now(),
                        data: data
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    lastSessionId = result.sessionId;
                    log(`✅ DB 저장 성공! SessionID: ${result.sessionId}`, 'success');
                    testResults.push({name: 'DB 저장', status: 'success', message: `SessionID: ${result.sessionId}`});
                } else {
                    log(`❌ DB 저장 실패: ${result.message}`, 'error');
                    testResults.push({name: 'DB 저장', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`❌ DB 저장 오류: ${error.message}`, 'error');
                testResults.push({name: 'DB 저장', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testLoadSession() {
            if (!lastSessionId) {
                log('⚠️ 먼저 DB 저장 테스트를 실행하세요.', 'error');
                return;
            }
            
            log('🧪 DB 불러오기 테스트 시작...');
            try {
                const response = await fetch(`/api/saveSession?sessionId=${lastSessionId}`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    log(`✅ DB 불러오기 성공! 데이터: ${JSON.stringify(result.data, null, 2)}`, 'success');
                    testResults.push({name: 'DB 불러오기', status: 'success', message: '데이터 로드 성공'});
                } else {
                    log(`❌ DB 불러오기 실패: ${result.message}`, 'error');
                    testResults.push({name: 'DB 불러오기', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`❌ DB 불러오기 오류: ${error.message}`, 'error');
                testResults.push({name: 'DB 불러오기', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testTemplates() {
            log('🧪 템플릿 불러오기 테스트 시작...');
            try {
                const response = await fetch('/api/hotels');
                const result = await response.json();
                
                if (result.success) {
                    log(`✅ 템플릿 불러오기 성공! ${result.count}개 템플릿 발견`, 'success');
                    log(`템플릿 목록: ${result.hotels.map(h => h.name).join(', ')}`, 'info');
                    testResults.push({name: '템플릿 불러오기', status: 'success', message: `${result.count}개 템플릿`});
                } else {
                    log(`❌ 템플릿 불러오기 실패`, 'error');
                    testResults.push({name: '템플릿 불러오기', status: 'error', message: '실패'});
                }
            } catch (error) {
                log(`❌ 템플릿 불러오기 오류: ${error.message}`, 'error');
                testResults.push({name: '템플릿 불러오기', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testHTMLGeneration() {
            log('🧪 HTML 생성 테스트 시작...');
            try {
                const data = getFormData();
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log(`✅ HTML 생성 성공! 파일 크기: ${result.size}자`, 'success');
                    log(`생성된 파일: ${result.url}`, 'info');
                    
                    // 생성된 HTML 파일 미리보기 링크
                    log(`🔗 미리보기: http://localhost:9002${result.url}`, 'info');
                    
                    testResults.push({name: 'HTML 생성', status: 'success', message: `${result.size}자, ${result.url}`});
                    
                    // 새 창에서 미리보기 열기
                    window.open(result.url, '_blank');
                } else {
                    log(`❌ HTML 생성 실패: ${result.message}`, 'error');
                    testResults.push({name: 'HTML 생성', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`❌ HTML 생성 오류: ${error.message}`, 'error');
                testResults.push({name: 'HTML 생성', status: 'error', message: error.message});
            }
            updateSummary();
        }

        function openMainApp() {
            log('🚀 메인 앱을 새 창에서 열고 있습니다...', 'info');
            window.open('http://localhost:9002', '_blank');
        }

        // 페이지 로드 시 초기화
        window.onload = function() {
            log('🎯 호텔 관리 시스템 테스트 페이지가 준비되었습니다.', 'success');
            log('위의 입력 필드에서 데이터를 수정한 후 테스트 버튼을 클릭하세요.', 'info');
        };
    </script>
</body>
</html> 