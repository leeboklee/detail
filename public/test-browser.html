<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜¸í…” ê´€ë¦¬ ì‹œìŠ¤í…œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .input-group textarea {
            height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ§ª í˜¸í…” ê´€ë¦¬ ì‹œìŠ¤í…œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-section">
            <h2>ğŸ“… íŒë§¤ê¸°ê°„&íˆ¬ìˆ™ì¼ ë°ì´í„° ì…ë ¥</h2>
            <div class="input-group">
                <label>íŒë§¤ ì‹œì‘ì¼:</label>
                <input type="date" id="saleStartDate" value="2024-02-01">
            </div>
            <div class="input-group">
                <label>íŒë§¤ ì¢…ë£Œì¼:</label>
                <input type="date" id="saleEndDate" value="2024-02-29">
            </div>
            <div class="input-group">
                <label>íˆ¬ìˆ™ ì‹œì‘ì¼:</label>
                <input type="date" id="stayStartDate" value="2024-03-01">
            </div>
            <div class="input-group">
                <label>íˆ¬ìˆ™ ì¢…ë£Œì¼:</label>
                <input type="date" id="stayEndDate" value="2024-03-31">
            </div>
            <div class="input-group">
                <label>ì–¼ë¦¬ë²„ë“œ í• ì¸:</label>
                <input type="text" id="earlyBirdDiscount" value="30ì¼ ì „ ì˜ˆì•½ ì‹œ 10% í• ì¸" placeholder="í• ì¸ ì •ë³´ ì…ë ¥">
            </div>
            <div class="input-group">
                <label>ì²´í¬ì¸ ì‹œê°„:</label>
                <input type="time" id="checkInTime" value="15:00">
            </div>
            <div class="input-group">
                <label>ì²´í¬ì•„ì›ƒ ì‹œê°„:</label>
                <input type="time" id="checkOutTime" value="11:00">
            </div>
            <div class="input-group">
                <label>íŠ¹ë³„ í˜œíƒ:</label>
                <textarea id="specialBenefits" placeholder="ì¡°ì‹ ë¬´ë£Œ ì œê³µ, ìŠ¤íŒŒ ì´ìš©ê¶Œ ë“±">ì¡°ì‹ ë¬´ë£Œ ì œê³µ, ì›°ì»´ ë“œë§í¬ ì„œë¹„ìŠ¤</textarea>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <button class="test-button" onclick="testSaveSession()">ğŸ’¾ DB ì €ì¥ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testLoadSession()">ğŸ“ DB ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testTemplates()">ğŸ“‹ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testHTMLGeneration()">ğŸ—ï¸ HTML ìƒì„± í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="openMainApp()">ğŸš€ ë©”ì¸ ì•± ì—´ê¸°</button>
            <div id="testResults" class="result-box"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
            <div id="testSummary" class="result-box">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
    </div>

    <script>
        let lastSessionId = null;
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const resultBox = document.getElementById('testResults');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            resultBox.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            resultBox.scrollTop = resultBox.scrollHeight;
        }

        function updateSummary() {
            const summary = document.getElementById('testSummary');
            const total = testResults.length;
            const passed = testResults.filter(r => r.status === 'success').length;
            const failed = testResults.filter(r => r.status === 'error').length;
            
            summary.innerHTML = `ì´ í…ŒìŠ¤íŠ¸: ${total}ê°œ
ì„±ê³µ: ${passed}ê°œ
ì‹¤íŒ¨: ${failed}ê°œ

ìƒì„¸ ê²°ê³¼:
${testResults.map(r => `${r.status === 'success' ? 'âœ…' : 'âŒ'} ${r.name}: ${r.message}`).join('\n')}`;
        }

        function getFormData() {
            return {
                period: {
                    saleStartDate: document.getElementById('saleStartDate').value,
                    saleEndDate: document.getElementById('saleEndDate').value,
                    stayStartDate: document.getElementById('stayStartDate').value,
                    stayEndDate: document.getElementById('stayEndDate').value,
                    earlyBirdDiscount: document.getElementById('earlyBirdDiscount').value,
                    checkInTime: document.getElementById('checkInTime').value,
                    checkOutTime: document.getElementById('checkOutTime').value,
                    specialBenefits: document.getElementById('specialBenefits').value
                }
            };
        }

        async function testSaveSession() {
            log('ğŸ§ª DB ì €ì¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const data = getFormData();
                const response = await fetch('/api/saveSession', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: 'browser-test-' + Date.now(),
                        data: data
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    lastSessionId = result.sessionId;
                    log(`âœ… DB ì €ì¥ ì„±ê³µ! SessionID: ${result.sessionId}`, 'success');
                    testResults.push({name: 'DB ì €ì¥', status: 'success', message: `SessionID: ${result.sessionId}`});
                } else {
                    log(`âŒ DB ì €ì¥ ì‹¤íŒ¨: ${result.message}`, 'error');
                    testResults.push({name: 'DB ì €ì¥', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`âŒ DB ì €ì¥ ì˜¤ë¥˜: ${error.message}`, 'error');
                testResults.push({name: 'DB ì €ì¥', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testLoadSession() {
            if (!lastSessionId) {
                log('âš ï¸ ë¨¼ì € DB ì €ì¥ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            log('ğŸ§ª DB ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch(`/api/saveSession?sessionId=${lastSessionId}`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    log(`âœ… DB ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ! ë°ì´í„°: ${JSON.stringify(result.data, null, 2)}`, 'success');
                    testResults.push({name: 'DB ë¶ˆëŸ¬ì˜¤ê¸°', status: 'success', message: 'ë°ì´í„° ë¡œë“œ ì„±ê³µ'});
                } else {
                    log(`âŒ DB ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${result.message}`, 'error');
                    testResults.push({name: 'DB ë¶ˆëŸ¬ì˜¤ê¸°', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`âŒ DB ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: ${error.message}`, 'error');
                testResults.push({name: 'DB ë¶ˆëŸ¬ì˜¤ê¸°', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testTemplates() {
            log('ğŸ§ª í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const response = await fetch('/api/hotels');
                const result = await response.json();
                
                if (result.success) {
                    log(`âœ… í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ! ${result.count}ê°œ í…œí”Œë¦¿ ë°œê²¬`, 'success');
                    log(`í…œí”Œë¦¿ ëª©ë¡: ${result.hotels.map(h => h.name).join(', ')}`, 'info');
                    testResults.push({name: 'í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°', status: 'success', message: `${result.count}ê°œ í…œí”Œë¦¿`});
                } else {
                    log(`âŒ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨`, 'error');
                    testResults.push({name: 'í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°', status: 'error', message: 'ì‹¤íŒ¨'});
                }
            } catch (error) {
                log(`âŒ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: ${error.message}`, 'error');
                testResults.push({name: 'í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°', status: 'error', message: error.message});
            }
            updateSummary();
        }

        async function testHTMLGeneration() {
            log('ğŸ§ª HTML ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            try {
                const data = getFormData();
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    log(`âœ… HTML ìƒì„± ì„±ê³µ! íŒŒì¼ í¬ê¸°: ${result.size}ì`, 'success');
                    log(`ìƒì„±ëœ íŒŒì¼: ${result.url}`, 'info');
                    
                    // ìƒì„±ëœ HTML íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ë§í¬
                    log(`ğŸ”— ë¯¸ë¦¬ë³´ê¸°: http://localhost:9002${result.url}`, 'info');
                    
                    testResults.push({name: 'HTML ìƒì„±', status: 'success', message: `${result.size}ì, ${result.url}`});
                    
                    // ìƒˆ ì°½ì—ì„œ ë¯¸ë¦¬ë³´ê¸° ì—´ê¸°
                    window.open(result.url, '_blank');
                } else {
                    log(`âŒ HTML ìƒì„± ì‹¤íŒ¨: ${result.message}`, 'error');
                    testResults.push({name: 'HTML ìƒì„±', status: 'error', message: result.message});
                }
            } catch (error) {
                log(`âŒ HTML ìƒì„± ì˜¤ë¥˜: ${error.message}`, 'error');
                testResults.push({name: 'HTML ìƒì„±', status: 'error', message: error.message});
            }
            updateSummary();
        }

        function openMainApp() {
            log('ğŸš€ ë©”ì¸ ì•±ì„ ìƒˆ ì°½ì—ì„œ ì—´ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
            window.open('http://localhost:9002', '_blank');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            log('ğŸ¯ í˜¸í…” ê´€ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            log('ìœ„ì˜ ì…ë ¥ í•„ë“œì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì •í•œ í›„ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
        };
    </script>
</body>
</html> 